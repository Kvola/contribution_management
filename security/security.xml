<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ================= RÈGLES POUR LES ACTIVITÉS DE GROUPE ================= -->
    
    <!-- Règle globale pour les activités - tous les utilisateurs peuvent voir toutes les activités -->
    <record id="group_activity_rule_global" model="ir.rule">
        <field name="name">Activités de groupe: accès global</field>
        <field name="model_id" ref="model_group_activity"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="0"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="0"/>
    </record>

    <!-- Règle pour les utilisateurs autorisés - peuvent créer et modifier les activités -->
    <record id="group_activity_rule_managers" model="ir.rule">
        <field name="name">Activités de groupe: gestionnaires</field>
        <field name="model_id" ref="model_group_activity"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- ================= RÈGLES POUR LES COTISATIONS MENSUELLES ================= -->
    
    <!-- Règle globale pour les cotisations mensuelles - accès en lecture pour tous -->
    <record id="monthly_cotisation_rule_global" model="ir.rule">
        <field name="name">Cotisations mensuelles: accès global</field>
        <field name="model_id" ref="model_monthly_cotisation"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="0"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="0"/>
    </record>

    <!-- Règle pour les gestionnaires - peuvent modifier les cotisations mensuelles -->
    <record id="monthly_cotisation_rule_managers" model="ir.rule">
        <field name="name">Cotisations mensuelles: gestionnaires</field>
        <field name="model_id" ref="model_monthly_cotisation"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- ================= RÈGLES POUR LES COTISATIONS INDIVIDUELLES ================= -->
    
    <!-- Règle pour les membres - peuvent voir uniquement leurs propres cotisations -->
    <record id="member_cotisation_rule_own" model="ir.rule">
        <field name="name">Cotisations: membres (leurs propres cotisations)</field>
        <field name="model_id" ref="model_member_cotisation"/>
        <field name="domain_force">[('member_id.user_ids', 'in', [user.id])]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="0"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="0"/>
    </record>

    <!-- Règle pour l'accès global aux cotisations (pour les gestionnaires) -->
    <record id="member_cotisation_rule_global" model="ir.rule">
        <field name="name">Cotisations: accès global</field>
        <field name="model_id" ref="model_member_cotisation"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- ================= RÈGLES POUR LES EXTENSIONS RES.PARTNER ================= -->
    
    <!-- Règle pour l'accès aux partenaires étendus -->
    <record id="res_partner_cotisation_rule_global" model="ir.rule">
        <field name="name">Partenaires: accès global pour cotisations</field>
        <field name="model_id" ref="base.model_res_partner"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="0"/>
    </record>

    <!-- ================= RÈGLES POUR LES ASSISTANTS (WIZARDS) ================= -->
    
    <!-- Règle pour l'assistant de paiement -->
    <record id="cotisation_payment_wizard_rule_global" model="ir.rule">
        <field name="name">Assistant de paiement: accès global</field>
        <field name="model_id" ref="model_cotisation_payment_wizard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règle pour l'assistant de rappel -->
    <record id="cotisation_reminder_wizard_rule_global" model="ir.rule">
        <field name="name">Assistant de rappel: accès global</field>
        <field name="model_id" ref="model_cotisation_reminder_wizard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règle pour l'assistant de paiement en masse -->
    <record id="mass_payment_wizard_rule_global" model="ir.rule">
        <field name="name">Assistant de paiement en masse: accès global</field>
        <field name="model_id" ref="model_mass_payment_wizard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règle pour l'assistant d'ajout de participants -->
    <record id="activity_participant_wizard_rule_global" model="ir.rule">
        <field name="name">Assistant de participants: accès global</field>
        <field name="model_id" ref="model_activity_participant_wizard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- ================= RÈGLES SPÉCIFIQUES POUR LA SÉCURITÉ ================= -->
    
    <!-- Règle pour empêcher la suppression des cotisations payées -->
    <record id="member_cotisation_rule_paid_no_delete" model="ir.rule">
        <field name="name">Cotisations payées: interdiction de suppression</field>
        <field name="model_id" ref="model_member_cotisation"/>
        <field name="domain_force">[('state', '!=', 'paid')]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="0"/>
        <field name="perm_write" eval="0"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règle pour empêcher la modification des activités terminées -->
    <record id="group_activity_rule_completed_readonly" model="ir.rule">
        <field name="name">Activités terminées: lecture seule</field>
        <field name="model_id" ref="model_group_activity"/>
        <field name="domain_force">[('state', '!=', 'completed')]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="0"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règle pour empêcher la modification des cotisations mensuelles fermées -->
    <record id="monthly_cotisation_rule_closed_readonly" model="ir.rule">
        <field name="name">Cotisations mensuelles fermées: lecture seule</field>
        <field name="model_id" ref="model_monthly_cotisation"/>
        <field name="domain_force">[('state', '!=', 'closed')]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="0"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="cotisations_dashboard_rule_global" model="ir.rule">
        <field name="name">Tableau de bord des cotisations: accès global</field>
        <field name="model_id" ref="model_cotisations_dashboard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>
    <record id="cotisations_dashboard_rule_manager" model="ir.rule">
        <field name="name">Tableau de bord des cotisations: gestionnaire</field>
        <field name="model_id" ref="model_cotisations_dashboard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_system'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>
    <record id="cotisations_dashboard_rule_portal" model="ir.rule">
        <field name="name">Tableau de bord des cotisations: portail</field>
        <field name="model_id" ref="model_cotisations_dashboard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="0"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="0"/>
    </record>
    <record id="cotisations_dashboard_rule_public" model="ir.rule">
        <field name="name">Tableau de bord des cotisations: public</field>
        <field name="model_id" ref="model_cotisations_dashboard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_public'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="0"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="0"/>
    </record>
    <record id="cotisations_dashboard_rule_user" model="ir.rule">
        <field name="name">Tableau de bord des cotisations: utilisateur</field>
        <field name="model_id" ref="model_cotisations_dashboard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- ================= RÈGLES DE SÉCURITÉ ================= -->
    
    <!-- Accès au wizard de rapports -->
    <record id="access_bulk_report_wizard_user" model="ir.model.access">
        <field name="name">bulk.report.wizard.user</field>
        <field name="model_id" ref="model_bulk_report_wizard"/>
        <field name="group_id" ref="base.group_user"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Accès aux logs pour utilisateurs -->
    <record id="access_report_generation_log_user" model="ir.model.access">
        <field name="name">report.generation.log.user</field>
        <field name="model_id" ref="model_report_generation_log"/>
        <field name="group_id" ref="base.group_user"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="0"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="0"/>
    </record>

    <!-- Accès complet aux logs pour managers -->
    <record id="access_report_generation_log_manager" model="ir.model.access">
        <field name="name">report.generation.log.manager</field>
        <field name="model_id" ref="model_report_generation_log"/>
        <field name="group_id" ref="base.group_system"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>
        <!-- Accès au modèle de prévisualisation -->
    <record id="access_bulk_report_preview_user" model="ir.model.access">
        <field name="name">bulk.report.preview.user</field>
        <field name="model_id" ref="model_bulk_report_preview"/>
        <field name="group_id" ref="base.group_user"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="0"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="0"/>
    </record>

    <!-- Règle pour le wizard de rapports en lot -->
    <record id="bulk_report_wizard_rule_global" model="ir.rule">
        <field name="name">Wizard de rapports en lot: accès global</field>
        <field name="model_id" ref="model_bulk_report_wizard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règle pour les logs de génération de rapports -->
    <record id="report_generation_log_rule_global" model="ir.rule">
        <field name="name">Logs de rapports: accès global</field>
        <field name="model_id" ref="model_report_generation_log"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="0"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="0"/>
    </record>

    <!-- Règle pour les managers sur les logs de génération de rapports -->
    <record id="report_generation_log_rule_manager" model="ir.rule">
        <field name="name">Logs de rapports: accès manager</field>
        <field name="model_id" ref="model_report_generation_log"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_system'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règles pour member.payment.plan -->
    <record id="member_payment_plan_rule_user" model="ir.rule">
        <field name="name">Plan de paiement: accès utilisateur</field>
        <field name="model_id" ref="model_member_payment_plan"/>
        <field name="domain_force">[('member_id.user_ids', 'in', [user.id])]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="member_payment_plan_rule_manager" model="ir.rule">
        <field name="name">Plan de paiement: accès manager</field>
        <field name="model_id" ref="model_member_payment_plan"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_system'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règles pour member.payment.installment -->
    <record id="member_payment_installment_rule_user" model="ir.rule">
        <field name="name">Échéance de paiement: accès utilisateur</field>
        <field name="model_id" ref="model_member_payment_installment"/>
        <field name="domain_force">[('member_id.user_ids', 'in', [user.id])]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="member_payment_installment_rule_manager" model="ir.rule">
        <field name="name">Échéance de paiement: accès manager</field>
        <field name="model_id" ref="model_member_payment_installment"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_system'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règles pour payment.plan.wizard -->
    <record id="payment_plan_wizard_rule_global" model="ir.rule">
        <field name="name">Assistant plan de paiement: accès global</field>
        <field name="model_id" ref="model_payment_plan_wizard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règles pour payment.plan.installment.preview -->
    <!-- Règles pour payment.plan.installment.preview -->
    <record id="payment_plan_installment_preview_rule_global" model="ir.rule">
        <field name="name">Aperçu échéance: accès global</field>
        <field name="model_id" ref="model_payment_plan_installment_preview"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règles pour quick.payment.wizard -->
    <record id="quick_payment_wizard_rule_global" model="ir.rule">
        <field name="name">Assistant paiement rapide: accès global</field>
        <field name="model_id" ref="model_quick_payment_wizard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règles pour cotisation.payment -->
    <record id="cotisation_payment_rule_user" model="ir.rule">
        <field name="name">Paiement cotisation: accès utilisateur</field>
        <field name="model_id" ref="model_cotisation_payment"/>
        <field name="domain_force">[('member_id.user_ids', 'in', [user.id])]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="cotisation_payment_rule_manager" model="ir.rule">
        <field name="name">Paiement cotisation: accès manager</field>
        <field name="model_id" ref="model_cotisation_payment"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_system'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règles de sécurité supplémentaires -->
    <record id="member_payment_plan_rule_completed_readonly" model="ir.rule">
        <field name="name">Plan de paiement terminé: lecture seule</field>
        <field name="model_id" ref="model_member_payment_plan"/>
        <field name="domain_force">[('state', '!=', 'completed')]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="0"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="member_payment_installment_rule_paid_readonly" model="ir.rule">
        <field name="name">Échéance payée: lecture seule</field>
        <field name="model_id" ref="model_member_payment_installment"/>
        <field name="domain_force">[('state', '!=', 'paid')]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="0"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règles pour group.activity -->
    <record id="group_activity_rule_user" model="ir.rule">
        <field name="name">Activités de groupe: accès utilisateur</field>
        <field name="model_id" ref="model_group_activity"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règles pour activity.expense -->
    <!-- <record id="activity_expense_rule_user" model="ir.rule">
        <field name="name">Dépenses d'activité: accès utilisateur</field>
        <field name="model_id" ref="model_activity_expense"/>
        <field name="domain_force">[
            '|',
            ('employee_id.user_ids', 'in', [user.id]),
            ('activity_id.group_id.manager_ids', 'in', [user.id])
        ]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record> -->

    <!-- Règles pour expense.category -->
    <record id="expense_category_rule_user" model="ir.rule">
        <field name="name">Catégories de dépenses: accès utilisateur</field>
        <field name="model_id" ref="model_expense_category"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règles pour les wizards -->
    <record id="activity_budget_analysis_wizard_rule_global" model="ir.rule">
        <field name="name">Wizard d'analyse budgétaire: accès global</field>
        <field name="model_id" ref="model_activity_budget_analysis_wizard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="activity_financial_report_wizard_rule_global" model="ir.rule">
        <field name="name">Wizard de rapport financier: accès global</field>
        <field name="model_id" ref="model_activity_financial_report_wizard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="expense_rejection_wizard_rule_global" model="ir.rule">
        <field name="name">Wizard de rejet de dépense: accès global</field>
        <field name="model_id" ref="model_expense_rejection_wizard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règles pour les rapports -->
    <record id="activity_budget_report_display_rule_global" model="ir.rule">
        <field name="name">Affichage rapport budgétaire: accès global</field>
        <field name="model_id" ref="model_activity_budget_report_display"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="activity_financial_analysis_rule_global" model="ir.rule">
        <field name="name">Analyse financière: accès global</field>
        <field name="model_id" ref="model_activity_financial_analysis"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règles de sécurité supplémentaires -->
    <record id="group_activity_rule_completed_readonly" model="ir.rule">
        <field name="name">Activités terminées: lecture seule</field>
        <field name="model_id" ref="model_group_activity"/>
        <field name="domain_force">[('state', '!=', 'completed')]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="0"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="activity_expense_rule_paid_readonly" model="ir.rule">
        <field name="name">Dépenses payées: lecture seule</field>
        <field name="model_id" ref="model_activity_expense"/>
        <field name="domain_force">[('state', '!=', 'paid')]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="0"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="1"/>
    </record>

        <!-- ================= RÈGLES POUR LES JUSTIFICATIFS DE PAIEMENT ================= -->
    
    <!-- Règle pour les membres - peuvent voir uniquement leurs propres justificatifs -->
    <record id="cotisation_payment_proof_rule_user" model="ir.rule">
        <field name="name">Justificatifs paiement: membres (leurs propres justificatifs)</field>
        <field name="model_id" ref="model_cotisation_payment_proof"/>
        <field name="domain_force">[('member_id.user_ids', 'in', [user.id])]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="0"/>
    </record>

    <!-- Règle pour l'accès global aux justificatifs (pour les gestionnaires) -->
    <record id="cotisation_payment_proof_rule_manager" model="ir.rule">
        <field name="name">Justificatifs paiement: accès global</field>
        <field name="model_id" ref="model_cotisation_payment_proof"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_system'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règle pour empêcher la modification des justificatifs validés -->
    <record id="cotisation_payment_proof_rule_validated_readonly" model="ir.rule">
        <field name="name">Justificatifs validés: lecture seule</field>
        <field name="model_id" ref="model_cotisation_payment_proof"/>
        <field name="domain_force">[('state', '!=', 'validated')]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="0"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règle pour le wizard de rejet de justificatif -->
    <record id="cotisation_payment_proof_reject_wizard_rule_global" model="ir.rule">
        <field name="name">Wizard rejet justificatif: accès global</field>
        <field name="model_id" ref="model_cotisation_payment_proof_reject_wizard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- ================= GROUPE DE SÉCURITÉ POUR LES GESTIONNAIRES DE COTISATIONS ================= -->
    
    <!-- Définition du groupe gestionnaire de cotisations -->
    <record id="group_cotisation_manager" model="res.groups">
        <field name="name">Gestionnaire de cotisations</field>
        <field name="category_id" ref="base.module_category_accounting_accounting"/>
        <field name="comment">Peut valider et gérer les justificatifs de paiement de cotisations</field>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- Groupe utilisateur standard des cotisations -->
    <record id="group_cotisation_user" model="res.groups">
        <field name="name">Utilisateur cotisations</field>
        <field name="category_id" ref="base.module_category_accounting_accounting"/>
        <field name="comment">Peut soumettre des justificatifs de paiement</field>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
    </record>

    <!-- ================= ACCÈS AUX MODÈLES POUR LE GROUPE GESTIONNAIRE ================= -->
    
    <!-- Accès complet pour les gestionnaires sur les justificatifs -->
    <record id="access_cotisation_payment_proof_manager" model="ir.model.access">
        <field name="name">cotisation.payment.proof.manager</field>
        <field name="model_id" ref="model_cotisation_payment_proof"/>
        <field name="group_id" ref="group_cotisation_manager"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Accès pour les gestionnaires sur le wizard de rejet -->
    <record id="access_cotisation_payment_proof_reject_wizard_manager" model="ir.model.access">
        <field name="name">cotisation.payment.proof.reject.wizard.manager</field>
        <field name="model_id" ref="model_cotisation_payment_proof_reject_wizard"/>
        <field name="group_id" ref="group_cotisation_manager"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Accès aux cotisations pour les gestionnaires -->
    <record id="access_member_cotisation_manager_group" model="ir.model.access">
        <field name="name">member.cotisation.manager.group</field>
        <field name="model_id" ref="model_member_cotisation"/>
        <field name="group_id" ref="group_cotisation_manager"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Accès aux paiements pour les gestionnaires -->
    <record id="access_cotisation_payment_manager_group" model="ir.model.access">
        <field name="name">cotisation.payment.manager.group</field>
        <field name="model_id" ref="model_cotisation_payment"/>
        <field name="group_id" ref="group_cotisation_manager"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- ================= RÈGLES DE SÉCURITÉ POUR LES GESTIONNAIRES ================= -->
    
    <!-- Règle pour les gestionnaires - accès complet aux justificatifs -->
    <record id="cotisation_payment_proof_rule_manager_full" model="ir.rule">
        <field name="name">Justificatifs paiement: gestionnaires (accès complet)</field>
        <field name="model_id" ref="model_cotisation_payment_proof"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('group_cotisation_manager'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règle pour les utilisateurs standard - accès limité aux justificatifs -->
    <record id="cotisation_payment_proof_rule_user_own" model="ir.rule">
        <field name="name">Justificatifs paiement: utilisateurs (leurs propres justificatifs)</field>
        <field name="model_id" ref="model_cotisation_payment_proof"/>
        <field name="domain_force">[('member_id.user_ids', 'in', [user.id])]</field>
        <field name="groups" eval="[(4, ref('group_cotisation_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="0"/>
    </record>

    <!-- Règle pour empêcher la modification des justificatifs validés par les utilisateurs standard -->
    <record id="cotisation_payment_proof_rule_validated_readonly_users" model="ir.rule">
        <field name="name">Justificatifs validés: lecture seule pour utilisateurs</field>
        <field name="model_id" ref="model_cotisation_payment_proof"/>
        <field name="domain_force">[('state', 'in', ['submitted', 'under_review'])]</field>
        <field name="groups" eval="[(4, ref('group_cotisation_user'))]"/>
        <field name="perm_read" eval="0"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- ================= DONNÉES DE DÉMONSTRATION ================= -->
    
    <!-- Ajouter les utilisateurs de démonstration aux groupes -->
    <record id="demo_user_manager" model="res.users">
        <field name="name">Gestionnaire Cotisations Demo</field>
        <field name="login">cotisation_manager</field>
        <field name="email">manager@cotisations.com</field>
        <field name="groups_id" eval="[(4, ref('group_cotisation_manager'))]"/>
        <field name="active" eval="False"/>  <!-- Désactivé par défaut -->
    </record>

    <record id="demo_user_standard" model="res.users">
        <field name="name">Utilisateur Cotisations Demo</field>
        <field name="login">cotisation_user</field>
        <field name="email">user@cotisations.com</field>
        <field name="groups_id" eval="[(4, ref('group_cotisation_user'))]"/>
        <field name="active" eval="False"/>  <!-- Désactivé par défaut -->
    </record>

        <!-- Groupes de sécurité spécifiques -->
        <record id="group_installment_allocation_manager" model="res.groups">
            <field name="name">Gestionnaire allocation échéances</field>
            <field name="category_id" ref="base.module_category_accounting_accounting"/>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <record id="group_installment_allocation_user" model="res.groups">
            <field name="name">Utilisateur allocation échéances</field>
            <field name="category_id" ref="base.module_category_accounting_accounting"/>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <!-- Règles de sécurité pour les modèles -->
        
        <!-- Accès aux liens échéances-cotisations -->
        <record id="access_installment_allocation_wizard_manager" model="ir.model.access">
            <field name="name">Installment Allocation Wizard Manager</field>
            <field name="model_id" ref="model_installment_allocation_wizard"/>
            <field name="group_id" ref="group_installment_allocation_manager"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="access_installment_allocation_wizard_user" model="ir.model.access">
            <field name="name">Installment Allocation Wizard User</field>
            <field name="model_id" ref="model_installment_allocation_wizard"/>
            <field name="group_id" ref="group_installment_allocation_user"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- Accès aux wizards de répartition manuelle -->
        <record id="access_manual_allocation_wizard_manager" model="ir.model.access">
            <field name="name">Manual Allocation Wizard Manager</field>
            <field name="model_id" ref="model_manual_allocation_wizard"/>
            <field name="group_id" ref="group_installment_allocation_manager"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="access_manual_allocation_line_manager" model="ir.model.access">
            <field name="name">Manual Allocation Line Manager</field>
            <field name="model_id" ref="model_manual_allocation_line"/>
            <field name="group_id" ref="group_installment_allocation_manager"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Accès aux wizards de configuration en lot -->
        <record id="access_batch_cotisation_link_wizard_manager" model="ir.model.access">
            <field name="name">Batch Cotisation Link Wizard Manager</field>
            <field name="model_id" ref="model_batch_cotisation_link_wizard"/>
            <field name="group_id" ref="group_installment_allocation_manager"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Accès aux aperçus d'impact -->
        <record id="access_cotisation_impact_preview_manager" model="ir.model.access">
            <field name="name">Cotisation Impact Preview Manager</field>
            <field name="model_id" ref="model_cotisation_impact_preview_wizard"/>
            <field name="group_id" ref="group_installment_allocation_manager"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record id="access_cotisation_impact_line_manager" model="ir.model.access">
            <field name="name">Cotisation Impact Line Manager</field>
            <field name="model_id" ref="model_cotisation_impact_line"/>
            <field name="group_id" ref="group_installment_allocation_manager"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Configuration globale membre -->
        <record id="access_member_allocation_config_manager" model="ir.model.access">
            <field name="name">Member Allocation Config Manager</field>
            <field name="model_id" ref="model_member_allocation_config_wizard"/>
            <field name="group_id" ref="group_installment_allocation_manager"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- Règles de domaine pour la sécurité des données -->
        
        <!-- Les utilisateurs ne voient que les données de leurs membres assignés -->
        <record id="rule_installment_allocation_user" model="ir.rule">
            <field name="name">Allocation échéances - Utilisateur</field>
            <field name="model_id" ref="model_member_payment_installment"/>
            <field name="domain_force">['|', ('member_id.user_id', '=', user.id), ('member_id.user_id', '=', False)]</field>
            <field name="groups" eval="[(4, ref('group_installment_allocation_user'))]"/>
        </record>

        <!-- Les gestionnaires voient tout -->
        <record id="rule_installment_allocation_manager" model="ir.rule">
            <field name="name">Allocation échéances - Gestionnaire</field>
            <field name="model_id" ref="model_member_payment_installment"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="groups" eval="[(4, ref('group_installment_allocation_manager'))]"/>
        </record>

    <!-- ================= RÈGLES POUR LES ACTIVITÉS DE GROUPE ================= -->
    <record id="group_activity_rule_user" model="ir.rule">
        <field name="name">Activités de groupe: accès utilisateur</field>
        <field name="model_id" ref="model_group_activity"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="group_activity_rule_portal" model="ir.rule">
        <field name="name">Activités de groupe: portail</field>
        <field name="model_id" ref="model_group_activity"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="0"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="0"/>
    </record>

    <record id="group_activity_rule_public" model="ir.rule">
        <field name="name">Activités de groupe: public</field>
        <field name="model_id" ref="model_group_activity"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_public'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="0"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="0"/>
    </record>

    <!-- Règle pour empêcher la modification des activités terminées -->
    <record id="group_activity_rule_completed_readonly" model="ir.rule">
        <field name="name">Activités terminées: lecture seule</field>
        <field name="model_id" ref="model_group_activity"/>
        <field name="domain_force">[('state', '!=', 'completed')]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="0"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- ================= RÈGLES POUR LES ORGANISATEURS ================= -->
    <record id="activity_organizer_rule_user" model="ir.rule">
        <field name="name">Organisateurs: accès utilisateur</field>
        <field name="model_id" ref="model_activity_organizer"/>
        <field name="domain_force">[('activity_id', 'in', user.activity_ids.ids)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- ================= RÈGLES POUR LES TÂCHES ================= -->
    <record id="activity_task_rule_user" model="ir.rule">
        <field name="name">Tâches: accès utilisateur</field>
        <field name="model_id" ref="model_activity_task"/>
        <field name="domain_force">[
            '|',
            ('activity_id', 'in', user.activity_ids.ids),
            ('assigned_to', '=', user.partner_id.id)
        ]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- ================= RÈGLES POUR LES DÉPENSES ================= -->
    <record id="activity_expense_rule_user" model="ir.rule">
        <field name="name">Dépenses: accès utilisateur</field>
        <field name="model_id" ref="model_activity_expense"/>
        <field name="domain_force">[
            '|',
            ('activity_id', 'in', user.activity_ids.ids),
            ('requested_by.partner_id', '=', user.partner_id.id)
        ]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- Règle pour empêcher la modification des dépenses payées -->
    <record id="activity_expense_rule_paid_readonly" model="ir.rule">
        <field name="name">Dépenses payées: lecture seule</field>
        <field name="model_id" ref="model_activity_expense"/>
        <field name="domain_force">[('state', '!=', 'paid')]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="0"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- ================= RÈGLES POUR LES CATÉGORIES ================= -->
    <record id="expense_category_rule_user" model="ir.rule">
        <field name="name">Catégories de dépenses: accès utilisateur</field>
        <field name="model_id" ref="model_expense_category"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="task_category_rule_user" model="ir.rule">
        <field name="name">Catégories de tâches: accès utilisateur</field>
        <field name="model_id" ref="model_task_category"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <!-- ================= RÈGLES POUR LES WIZARDS ================= -->
    <record id="task_completion_wizard_rule_global" model="ir.rule">
        <field name="name">Assistant completion tâche: accès global</field>
        <field name="model_id" ref="model_task_completion_wizard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="task_hold_wizard_rule_global" model="ir.rule">
        <field name="name">Assistant mise en attente: accès global</field>
        <field name="model_id" ref="model_task_hold_wizard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="task_assignment_wizard_rule_global" model="ir.rule">
        <field name="name">Assistant assignation tâches: accès global</field>
        <field name="model_id" ref="model_task_assignment_wizard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>

    <record id="activity_organization_dashboard_rule_global" model="ir.rule">
        <field name="name">Tableau de bord organisation: accès global</field>
        <field name="model_id" ref="model_activity_organization_dashboard"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="1"/>
        <field name="perm_create" eval="1"/>
        <field name="perm_unlink" eval="1"/>
    </record>
</odoo>