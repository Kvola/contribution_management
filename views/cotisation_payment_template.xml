<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="404_custom" name="Page 404 Personnalisée" inherit_id="http_routing.404">
        <xpath expr="//div[hasclass('container')]" position="replace">
            <div class="container text-center py-5">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <!-- Image ou icône 404 -->
                        <div class="mb-4">
                            <i class="fa fa-exclamation-triangle fa-5x text-warning mb-3"></i>
                            <h1 class="display-1 fw-bold text-primary">404</h1>
                        </div>

                        <!-- Message principal -->
                        <h2 class="mb-4">Oups ! Page non trouvée</h2>
                        <p class="lead mb-4">
                            La page que vous recherchez n'existe pas ou a été déplacée.
                            Ne vous inquiétez pas, nous pouvons vous aider à trouver ce que vous
                            cherchez.
                        </p>

                        <!-- Boutons d'action -->
                        <div class="mb-4">
                            <a href="/" class="btn btn-primary btn-lg me-3">
                                <i class="fa fa-home"></i> Retour à l'accueil </a>
                            <a href="/contactus" class="btn btn-outline-secondary btn-lg">
                                <i class="fa fa-envelope"></i> Nous contacter </a>
                        </div>

                        <!-- Suggestions de pages -->
                        <div class="row mt-5">
                            <div class="col-md-4">
                                <div class="card h-100 shadow-sm">
                                    <div class="card-body">
                                        <i class="fa fa-shopping-cart fa-2x text-primary mb-3"></i>
                                        <h5 class="card-title">Nos Produits</h5>
                                        <p class="card-text">Découvrez notre gamme complète de
                                            produits.</p>
                                        <a href="/shop" class="btn btn-outline-primary">Voir les
                                            produits</a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card h-100 shadow-sm">
                                    <div class="card-body">
                                        <i class="fa fa-info-circle fa-2x text-success mb-3"></i>
                                        <h5 class="card-title">À propos</h5>
                                        <p class="card-text">Apprenez-en plus sur notre entreprise.</p>
                                        <a href="/aboutus" class="btn btn-outline-success">En savoir
                                            plus</a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card h-100 shadow-sm">
                                    <div class="card-body">
                                        <i class="fa fa-blog fa-2x text-info mb-3"></i>
                                        <h5 class="card-title">Blog</h5>
                                        <p class="card-text">Lisez nos derniers articles et
                                            actualités.</p>
                                        <a href="/blog" class="btn btn-outline-info">Lire le blog</a>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Barre de recherche -->
                        <div class="mt-5">
                            <h4 class="mb-3">Ou utilisez la recherche :</h4>
                            <form class="d-flex justify-content-center" action="/website/search"
                                method="GET">
                                <div class="input-group" style="max-width: 500px;">
                                    <input type="text" class="form-control form-control-lg"
                                        name="search" placeholder="Rechercher sur le site..."
                                        aria-label="Recherche" />
                                    <button class="btn btn-primary" type="submit">
                                        <i class="fa fa-search"></i>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </xpath>
    </template>
    
    <!-- ============================================
         TEMPLATE: Liste des cotisations (CORRIGÉ)
         ============================================ -->
    <template id="my_cotisations_list" name="Mes Cotisations - Version Améliorée">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True" />

            <t t-call="portal.portal_searchbar">
                <t t-set="title">Mes Cotisations</t>
            </t>

            <!-- Intégration du CSS amélioré -->
            <t t-call="contribution_management.enhanced_css_styles" />

            <div class="o_portal_wrap">
                <div class="o_portal_my_doc o_portal_my_cotisations">
                    <div class="container">
                        
                        <!-- ===============================
                             SECTION: Tableau de bord amélioré
                             =============================== -->
                        <div class="row mb-4 fade-in-up">
                            <!-- Carte: Total cotisations -->
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="card dashboard-card primary-card h-100">
                                    <div class="card-body text-center">
                                        <div class="mb-3">
                                            <i class="fa fa-list-alt fa-3x mb-2"></i>
                                        </div>
                                        <h3 class="card-title" t-esc="total_cotisations or 0" />
                                        <p class="card-text">Total Cotisations</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Carte: Cotisations payées -->
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="card dashboard-card success-card h-100">
                                    <div class="card-body text-center">
                                        <div class="mb-3">
                                            <i class="fa fa-check-circle fa-3x mb-2"></i>
                                        </div>
                                        <h3 class="card-title" t-esc="paid_cotisations or 0" />
                                        <p class="card-text">Payées</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Carte: Cotisations en attente -->
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="card dashboard-card warning-card h-100">
                                    <div class="card-body text-center">
                                        <div class="mb-3">
                                            <i class="fa fa-clock-o fa-3x mb-2"></i>
                                        </div>
                                        <h3 class="card-title" t-esc="pending_cotisations or 0" />
                                        <p class="card-text">En attente</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Carte: Montant dû -->
                            <div class="col-lg-3 col-md-6 mb-3">
                                <div class="card dashboard-card danger-card h-100">
                                    <div class="card-body text-center">
                                        <div class="mb-3">
                                            <i class="fa fa-exclamation-triangle fa-3x mb-2"></i>
                                        </div>
                                        <h3 class="card-title">
                                            <t t-if="total_amount_due and currency_id">
                                                <span t-esc="'%.0f' % total_amount_due" />
                                                <small class="ms-1" t-esc="currency_id.symbol or 'FCFA'" />
                                            </t>
                                            <t t-else="">0</t>
                                        </h3>
                                        <p class="card-text">Montant dû</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ===============================
                             SECTION: Navigation améliorée
                             =============================== -->
                        <nav aria-label="breadcrumb" class="mb-4 fade-in-down">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item">
                                    <a href="/my">
                                        <i class="fa fa-home me-2"></i>Mon Compte
                                    </a>
                                </li>
                                <li class="breadcrumb-item active" aria-current="page">
                                    <i class="fa fa-list-alt me-2"></i>Mes Cotisations
                                </li>
                            </ol>
                        </nav>

                        <!-- ===============================
                             SECTION: Actions rapides améliorées
                             =============================== -->
                        <div class="card glass-card mb-4 slide-in-left">
                            <div class="card-body">
                                <div class="d-flex flex-wrap align-items-center justify-content-between">
                                    <div class="d-flex flex-wrap gap-2 mb-2 mb-md-0">
                                        <a href="/my/cotisations/history" class="btn btn-outline-primary hover-lift">
                                            <i class="fa fa-history me-2"></i>Historique des paiements
                                        </a>
                                        <button class="btn btn-outline-secondary" type="button"
                                            data-bs-toggle="collapse" data-bs-target="#filterCollapse">
                                            <i class="fa fa-filter me-2"></i>Filtrer
                                        </button>
                                        <!-- <button class="btn btn-outline-info" type="button" onclick="refreshDashboard()">
                                            <i class="fa fa-refresh me-2"></i>Actualiser
                                        </button> -->
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <small class="text-muted me-3">
                                            <i class="fa fa-calendar me-1"></i>
                                            Dernière mise à jour: <span id="lastUpdate"></span>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ===============================
                             SECTION: Filtres améliorés
                             =============================== -->
                        <div class="collapse mb-4" id="filterCollapse">
                            <div class="card shadow-custom">
                                <div class="card-header">
                                    <h6 class="mb-0 text-gradient">
                                        <i class="fa fa-filter me-2"></i>Filtres de recherche
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <form method="get" class="row g-3" id="filterForm">
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" />

                                        <div class="col-md-4">
                                            <label class="form-label">
                                                <i class="fa fa-info-circle"></i>Statut
                                            </label>
                                            <select name="state" class="form-select">
                                                <option value="">Tous les statuts</option>
                                                <option value="pending" t-att-selected="'selected' if filterby == 'pending' else None">
                                                    En attente
                                                </option>
                                                <option value="partial" t-att-selected="'selected' if filterby == 'partial' else None">
                                                    Partiel
                                                </option>
                                                <option value="paid" t-att-selected="'selected' if filterby == 'paid' else None">
                                                    Payé
                                                </option>
                                                <option value="overdue" t-att-selected="'selected' if filterby == 'overdue' else None">
                                                    En retard
                                                </option>
                                            </select>
                                        </div>

                                        <div class="col-md-4">
                                            <label class="form-label">
                                                <i class="fa fa-tag"></i>Type
                                            </label>
                                            <select name="type" class="form-select">
                                                <option value="">Tous les types</option>
                                                <option value="monthly" t-att-selected="'selected' if filterby == 'monthly' else None">
                                                    Mensuelle
                                                </option>
                                                <option value="activity" t-att-selected="'selected' if filterby == 'activity' else None">
                                                    Activité
                                                </option>
                                            </select>
                                        </div>

                                        <div class="col-md-4">
                                            <label class="form-label">
                                                <i class="fa fa-calendar"></i>Période
                                            </label>
                                            <select name="period" class="form-select" onchange="handlePeriodChange(this)">
                                                <option value="">Toute période</option>
                                                <option value="this_month">Ce mois</option>
                                                <option value="last_month">Le mois dernier</option>
                                                <option value="this_year">Cette année</option>
                                                <option value="overdue">Échues</option>
                                            </select>
                                        </div>

                                        <div class="col-12">
                                            <div class="d-flex gap-2">
                                                <button type="submit" class="btn btn-primary">
                                                    <i class="fa fa-search me-2"></i>Appliquer les filtres
                                                </button>
                                                <a href="/my/cotisations" class="btn btn-outline-secondary">
                                                    <i class="fa fa-times me-2"></i>Réinitialiser
                                                </a>
                                                <button type="button" class="btn btn-outline-info" onclick="exportCotisations()">
                                                    <i class="fa fa-download me-2"></i>Exporter
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- ===============================
                             SECTION: Messages d'alerte améliorés
                             =============================== -->
                        <t t-if="success_message">
                            <div class="alert alert-success alert-dismissible bounce-animation" role="alert">
                                <div class="d-flex align-items-center">
                                    <i class="fa fa-check-circle fa-2x me-3"></i>
                                    <div class="flex-grow-1">
                                        <h6 class="alert-heading mb-1">Succès !</h6>
                                        <span t-esc="success_message" />
                                    </div>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            </div>
                        </t>

                        <t t-if="error_message">
                            <div class="alert alert-danger alert-dismissible bounce-animation" role="alert">
                                <div class="d-flex align-items-center">
                                    <i class="fa fa-exclamation-triangle fa-2x me-3"></i>
                                    <div class="flex-grow-1">
                                        <h6 class="alert-heading mb-1">Erreur !</h6>
                                        <span t-esc="error_message" />
                                    </div>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            </div>
                        </t>

                        <!-- ===============================
                             SECTION: Liste des cotisations améliorée
                             =============================== -->
                        <div class="card shadow-custom slide-in-right">
                            <!-- En-tête amélioré -->
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h4 class="mb-0 text-gradient">
                                        <i class="fa fa-list-alt me-2"></i>Liste de mes cotisations
                                    </h4>
                                    <div class="d-flex align-items-center gap-3">
                                        <span class="badge bg-primary fs-6" t-esc="cotisations_count or 0" />
                                        <div class="btn-group btn-group-sm">
                                            <button class="btn btn-outline-secondary" onclick="toggleView('table')" id="tableViewBtn">
                                                <i class="fa fa-table"></i>
                                            </button>
                                            <button class="btn btn-outline-secondary" onclick="toggleView('cards')" id="cardsViewBtn">
                                                <i class="fa fa-th-large"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Corps amélioré -->
                            <div class="card-body">
                                <!-- Cas: Aucune cotisation -->
                                <t t-if="not cotisations">
                                    <div class="text-center py-5">
                                        <div class="mb-4">
                                            <i class="fa fa-inbox fa-5x text-muted opacity-50"></i>
                                        </div>
                                        <h5 class="text-muted mb-3">Aucune cotisation trouvée</h5>
                                        <p class="text-muted mb-4">
                                            Vous n'avez actuellement aucune cotisation correspondant à vos critères de recherche.
                                        </p>
                                        <div class="d-flex justify-content-center gap-2">
                                            <a href="/my/cotisations" class="btn btn-primary">
                                                <i class="fa fa-refresh me-2"></i>Voir toutes les cotisations
                                            </a>
                                            <a href="/my" class="btn btn-outline-secondary">
                                                <i class="fa fa-home me-2"></i>Retour au tableau de bord
                                            </a>
                                        </div>
                                    </div>
                                </t>

                                <!-- Cas: Cotisations trouvées -->
                                <t t-else="">
                                    <!-- Indicateurs de progression -->
                                    <div class="row mb-4" id="progressIndicators">
                                        <div class="col-md-4">
                                            <div class="d-flex align-items-center">
                                                <span class="text-muted me-2">Progression globale:</span>
                                                <div class="progress flex-grow-1" style="height: 8px;">
                                                    <t t-set="progress_percentage" t-value="int((paid_cotisations * 100 / total_cotisations) if total_cotisations > 0 else 0)" />
                                                    <div class="progress-bar bg-success" role="progressbar" 
                                                         t-att-style="'width: ' + str(progress_percentage) + '%%'">
                                                    </div>
                                                </div>
                                                <span class="text-muted ms-2 small" t-esc="str(progress_percentage) + '%%'"></span>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="d-flex align-items-center">
                                                <span class="text-muted me-2">Taux de retard:</span>
                                                <div class="progress flex-grow-1" style="height: 8px;">
                                                    <t t-set="overdue_percentage" t-value="int((overdue_cotisations * 100 / total_cotisations) if total_cotisations > 0 else 0)" />
                                                    <div class="progress-bar bg-danger" role="progressbar" 
                                                         t-att-style="'width: ' + str(overdue_percentage) + '%%'">
                                                    </div>
                                                </div>
                                                <span class="text-muted ms-2 small" t-esc="str(overdue_percentage) + '%%'"></span>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-end">
                                                <small class="text-muted">
                                                    <i class="fa fa-clock-o me-1"></i>
                                                    <span id="currentDateTime"></span>
                                                </small>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Vue en tableau (desktop) -->
                                    <div id="tableView" class="d-none d-lg-block">
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th scope="col">
                                                            <i class="fa fa-file-text-o me-1"></i>Description
                                                        </th>
                                                        <th scope="col">
                                                            <i class="fa fa-users me-1"></i>Groupe
                                                        </th>
                                                        <th scope="col">
                                                            <i class="fa fa-tag me-1"></i>Type
                                                        </th>
                                                        <th scope="col" class="text-end">
                                                            <i class="fa fa-money me-1"></i>Montant dû
                                                        </th>
                                                        <th scope="col" class="text-end">
                                                            <i class="fa fa-check me-1"></i>Payé
                                                        </th>
                                                        <th scope="col" class="text-end">
                                                            <i class="fa fa-balance-scale me-1"></i>Restant
                                                        </th>
                                                        <th scope="col" class="text-center">
                                                            <i class="fa fa-calendar me-1"></i>Échéance
                                                        </th>
                                                        <th scope="col" class="text-center">
                                                            <i class="fa fa-info-circle me-1"></i>Statut
                                                        </th>
                                                        <th scope="col" class="text-center">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr t-foreach="cotisations" t-as="cotisation" class="fade-in-up" 
                                                        t-att-style="'animation-delay: ' + str(cotisation_index * 100) + 'ms'">
                                                        <td class="align-middle">
                                                            <div class="state-indicator" 
                                                                 t-att-class="'paid' if cotisation.state == 'paid' 
                                                                            else 'pending' if cotisation.state in ['pending', 'partial'] 
                                                                            else 'overdue'">
                                                                <strong class="text-truncate d-block" 
                                                                        t-esc="cotisation.description or cotisation.display_name"
                                                                        style="max-width: 200px;" />
                                                                <t t-if="cotisation.days_overdue and cotisation.days_overdue > 0">
                                                                    <small class="text-danger">
                                                                        <i class="fa fa-exclamation-triangle me-1"></i>
                                                                        En retard de <span t-esc="cotisation.days_overdue" /> jour(s)
                                                                    </small>
                                                                </t>
                                                            </div>
                                                        </td>
                                                        <td class="align-middle">
                                                            <span class="text-truncate d-block" t-esc="cotisation.group_id.name" 
                                                                  style="max-width: 150px;" />
                                                        </td>
                                                        <td class="align-middle">
                                                            <span class="badge" 
                                                                  t-att-class="'bg-info' if cotisation.cotisation_type == 'monthly' else 'bg-primary'">
                                                                <i class="fa fa-calendar me-1" t-if="cotisation.cotisation_type == 'monthly'" />
                                                                <i class="fa fa-star me-1" t-else="" />
                                                                <t t-if="cotisation.cotisation_type == 'monthly'">Mensuelle</t>
                                                                <t t-else="">Activité</t>
                                                            </span>
                                                        </td>
                                                        <td class="align-middle text-end">
                                                            <span class="fw-bold" t-field="cotisation.amount_due"
                                                                  t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
                                                        </td>
                                                        <td class="align-middle text-end">
                                                            <span class="text-success" t-field="cotisation.amount_paid"
                                                                  t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
                                                        </td>
                                                        <td class="align-middle text-end">
                                                            <span class="fw-bold" t-field="cotisation.remaining_amount"
                                                                  t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}"
                                                                  t-att-class="'text-success' if cotisation.remaining_amount == 0 else 'text-warning'" />
                                                        </td>
                                                        <td class="align-middle text-center">
                                                            <div>
                                                                <span t-field="cotisation.due_date" t-options="{'widget': 'date'}" />
                                                                <t t-if="cotisation.due_date and cotisation.due_date &lt; current_date and cotisation.state != 'paid'">
                                                                    <br />
                                                                    <small class="badge bg-danger">Échue</small>
                                                                </t>
                                                            </div>
                                                        </td>
                                                        <td class="align-middle text-center">
                                                            <span class="badge fs-6"
                                                                  t-att-class="'bg-success' if cotisation.state == 'paid' 
                                                                             else 'bg-warning text-dark' if cotisation.state == 'partial' 
                                                                             else 'bg-danger' if cotisation.state == 'overdue' 
                                                                             else 'bg-secondary'">
                                                                <i class="fa fa-check me-1" t-if="cotisation.state == 'paid'" />
                                                                <i class="fa fa-clock-o me-1" t-elif="cotisation.state == 'partial'" />
                                                                <i class="fa fa-exclamation-triangle me-1" t-elif="cotisation.state == 'overdue'" />
                                                                <i class="fa fa-pause me-1" t-else="" />
                                                                <t t-if="cotisation.state == 'paid'">Payé</t>
                                                                <t t-elif="cotisation.state == 'partial'">Partiel</t>
                                                                <t t-elif="cotisation.state == 'overdue'">En retard</t>
                                                                <t t-else="">En attente</t>
                                                            </span>
                                                        </td>
                                                        <td class="align-middle text-center">
                                                            <div class="btn-group btn-group-sm" role="group">
                                                                <t t-if="cotisation.state in ['pending', 'partial', 'overdue'] and cotisation.remaining_amount > 0">
                                                                    <a t-attf-href="/my/cotisation/#{cotisation.id}/pay" 
                                                                       class="btn btn-primary hover-lift">
                                                                        <i class="fa fa-credit-card me-1"></i>Payer
                                                                    </a>
                                                                </t>
                                                                <a t-attf-href="/my/cotisation/#{cotisation.id}" 
                                                                   class="btn btn-outline-primary hover-lift">
                                                                    <i class="fa fa-eye me-1"></i>Voir
                                                                </a>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <!-- Vue en cartes (mobile et optionnelle desktop) -->
                                    <div id="cardsView" class="d-lg-none">
                                        <div class="row g-3">
                                            <div class="col-12 col-md-6" t-foreach="cotisations" t-as="cotisation">
                                                <div class="card border-start border-4 hover-lift fade-in-up"
                                                     t-att-class="'border-success' if cotisation.state == 'paid' 
                                                                else 'border-warning' if cotisation.state == 'partial' 
                                                                else 'border-danger' if cotisation.state == 'overdue' 
                                                                else 'border-secondary'"
                                                     t-att-style="'animation-delay: ' + str(cotisation_index * 150) + 'ms'">
                                                    <div class="card-body p-3">
                                                        <!-- En-tête de carte -->
                                                        <div class="d-flex justify-content-between align-items-start mb-3">
                                                            <h6 class="card-title mb-1 text-truncate" 
                                                                t-esc="cotisation.description or cotisation.display_name"
                                                                style="max-width: 200px;" />
                                                            <span class="badge"
                                                                  t-att-class="'bg-success' if cotisation.state == 'paid' 
                                                                             else 'bg-warning' if cotisation.state == 'partial' 
                                                                             else 'bg-danger' if cotisation.state == 'overdue' 
                                                                             else 'bg-secondary'">
                                                                <t t-if="cotisation.state == 'paid'">Payé</t>
                                                                <t t-elif="cotisation.state == 'partial'">Partiel</t>
                                                                <t t-elif="cotisation.state == 'overdue'">En retard</t>
                                                                <t t-else="">En attente</t>
                                                            </span>
                                                        </div>

                                                        <!-- Informations de la cotisation -->
                                                        <div class="row g-2 small text-muted mb-3">
                                                            <div class="col-6">
                                                                <i class="fa fa-users text-primary me-1"></i>
                                                                <strong>Groupe:</strong><br />
                                                                <span t-esc="cotisation.group_id.name" class="text-truncate d-block" />
                                                            </div>
                                                            <div class="col-6">
                                                                <i class="fa fa-calendar text-info me-1"></i>
                                                                <strong>Échéance:</strong><br />
                                                                <span t-field="cotisation.due_date" t-options="{'widget': 'date'}" />
                                                            </div>
                                                            <div class="col-6">
                                                                <i class="fa fa-money text-success me-1"></i>
                                                                <strong>Montant dû:</strong><br />
                                                                <span t-field="cotisation.amount_due"
                                                                      t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
                                                            </div>
                                                            <div class="col-6">
                                                                <i class="fa fa-balance-scale text-warning me-1"></i>
                                                                <strong>Restant:</strong><br />
                                                                <span t-field="cotisation.remaining_amount"
                                                                      t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}"
                                                                      t-att-class="'text-success fw-bold' if cotisation.remaining_amount == 0 else 'text-warning fw-bold'" />
                                                            </div>
                                                        </div>

                                                        <!-- Progress bar -->
                                                        <div class="mb-3">
                                                            <div class="d-flex justify-content-between align-items-center mb-1">
                                                                <small class="text-muted">Progression</small>
                                                                <t t-set="card_progress" t-value="int((cotisation.amount_paid * 100 / cotisation.amount_due) if cotisation.amount_due > 0 else 0)" />
                                                                <small class="text-muted" t-esc="str(card_progress) + '%%'"></small>
                                                            </div>
                                                            <div class="progress" style="height: 6px;">
                                                                <div class="progress-bar" 
                                                                     t-att-class="'bg-success' if cotisation.state == 'paid' else 'bg-warning'"
                                                                     t-att-style="'width: ' + str(card_progress) + '%%'">
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <!-- Actions -->
                                                        <div class="d-flex justify-content-end gap-2">
                                                            <t t-if="cotisation.state in ['pending', 'partial', 'overdue'] and cotisation.remaining_amount > 0">
                                                                <a t-attf-href="/my/cotisation/#{cotisation.id}/pay" 
                                                                   class="btn btn-primary btn-sm hover-lift">
                                                                    <i class="fa fa-credit-card me-1"></i>Payer
                                                                </a>
                                                            </t>
                                                            <a t-attf-href="/my/cotisation/#{cotisation.id}" 
                                                               class="btn btn-outline-primary btn-sm hover-lift">
                                                                <i class="fa fa-eye me-1"></i>Voir
                                                            </a>
                                                        </div>

                                                        <!-- Indicateur de retard -->
                                                        <t t-if="cotisation.days_overdue and cotisation.days_overdue > 0">
                                                            <div class="alert alert-danger alert-sm mt-2 mb-0 py-2 px-3">
                                                                <i class="fa fa-exclamation-triangle me-2"></i>
                                                                <small>En retard de <span t-esc="cotisation.days_overdue" /> jour(s)</small>
                                                            </div>
                                                        </t>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </div>

                        <!-- ===============================
                             SECTION: Pagination améliorée
                             =============================== -->
                        <t t-if="pager and pager.get('page_count', 0) > 1">
                            <div class="d-flex justify-content-center mt-4 fade-in-up">
                                <t t-call="portal.pager" />
                            </div>
                        </t>

                        <!-- ===============================
                             SECTION: Actions flottantes (FAB)
                             =============================== -->
                        <div class="floating-action-buttons">
                            <div class="fab-container">
                                <button class="fab fab-main" onclick="toggleFabMenu()">
                                    <i class="fa fa-plus"></i>
                                </button>
                                <div class="fab-options">
                                    <a href="/my/cotisations/history" class="fab fab-option" title="Historique">
                                        <i class="fa fa-history"></i>
                                    </a>
                                    <button class="fab fab-option" onclick="exportCotisations()" title="Exporter">
                                        <i class="fa fa-download"></i>
                                    </button>
                                    <!-- <button class="fab fab-option" onclick="refreshDashboard()" title="Actualiser">
                                        <i class="fa fa-refresh"></i>
                                    </button> -->
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- ===============================
                 SECTION: Scripts JavaScript avancés
                 =============================== -->
            <script type="text/javascript">
                document.addEventListener('DOMContentLoaded', function() {
                    // ==============================
                    // Initialisation des animations
                    // ==============================
                    initializeAnimations();
                    updateDateTime();
                    setInterval(updateDateTime, 60000); // Mise à jour chaque minute
                    
                    // ==============================
                    // Gestion des vues
                    // ==============================
                    const savedView = localStorage.getItem('cotisationsView') || 'table';
                    toggleView(savedView);

                    // ==============================
                    // Auto-dismiss des alertes
                    // ==============================
                    setTimeout(() => {
                        const alerts = document.querySelectorAll('.alert-dismissible');
                        alerts.forEach(alert => {
                            if (alert.classList.contains('alert-success')) {
                                const bsAlert = new bootstrap.Alert(alert);
                                bsAlert.close();
                            }
                        });
                    }, 5000);

                    // ==============================
                    // Tooltips pour les éléments tronqués
                    // ==============================
                    initializeTooltips();

                    // ==============================
                    // Lazy loading des cartes
                    // ==============================
                    initializeLazyLoading();
                });

                // ==============================
                // Fonctions d'animation
                // ==============================
                function initializeAnimations() {
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.classList.add('animate');
                            }
                        });
                    }, {
                        threshold: 0.1,
                        rootMargin: '0px 0px -50px 0px'
                    });

                    document.querySelectorAll('.fade-in-up, .slide-in-left, .slide-in-right').forEach(el => {
                        observer.observe(el);
                    });
                }

                // ==============================
                // Gestion du temps
                // ==============================
                function updateDateTime() {
                    const now = new Date();
                    const options = {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    };
                    
                    const currentDateTimeEl = document.getElementById('currentDateTime');
                    const lastUpdateEl = document.getElementById('lastUpdate');
                    
                    if (currentDateTimeEl) {
                        currentDateTimeEl.textContent = now.toLocaleDateString('fr-FR', options);
                    }
                    
                    if (lastUpdateEl) {
                        lastUpdateEl.textContent = now.toLocaleTimeString('fr-FR', {
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    }
                }

                // ==============================
                // Gestion des vues
                // ==============================
                function toggleView(viewType) {
                    const tableView = document.getElementById('tableView');
                    const cardsView = document.getElementById('cardsView');
                    const tableBtn = document.getElementById('tableViewBtn');
                    const cardsBtn = document.getElementById('cardsViewBtn');

                    if (viewType === 'table') {
                        if (tableView) tableView.classList.remove('d-none', 'd-lg-block');
                        if (tableView) tableView.classList.add('d-block');
                        if (cardsView) cardsView.classList.add('d-none');
                        if (tableBtn) tableBtn.classList.add('active');
                        if (cardsBtn) cardsBtn.classList.remove('active');
                    } else {
                        if (tableView) tableView.classList.add('d-none');
                        if (cardsView) cardsView.classList.remove('d-none', 'd-lg-none');
                        if (cardsView) cardsView.classList.add('d-block');
                        if (cardsBtn) cardsBtn.classList.add('active');
                        if (tableBtn) tableBtn.classList.remove('active');
                    }

                    localStorage.setItem('cotisationsView', viewType);
                }

                // ==============================
                // Menu FAB flottant
                // ==============================
                function toggleFabMenu() {
                    const fabContainer = document.querySelector('.fab-container');
                    fabContainer.classList.toggle('open');
                }

                // ==============================
                // Actualisation du tableau de bord
                // ==============================
                function refreshDashboard() {
                    // Afficher un spinner de chargement
                    showLoadingOverlay();
                    
                    // Simuler un refresh (remplacez par votre logique AJAX)
                    setTimeout(() => {
                        hideLoadingOverlay();
                        location.reload();
                    }, 2000);
                }

                function showLoadingOverlay() {
                    const overlay = document.createElement('div');
                    overlay.className = 'loading-overlay';
                    overlay.innerHTML = `
                        <div class="text-center">
                            <div class="loading-spinner"></div>
                            <p class="mt-3 text-muted">Actualisation en cours...</p>
                        </div>
                    `;
                    document.body.appendChild(overlay);
                }

                function hideLoadingOverlay() {
                    const overlay = document.querySelector('.loading-overlay');
                    if (overlay) {
                        overlay.remove();
                    }
                }

                // ==============================
                // Export des données
                // ==============================
                function exportCotisations() {
                    // Logique d'export (CSV, Excel, PDF)
                    const exportData = gatherExportData();
                    downloadCSV(exportData, 'mes_cotisations.csv');
                }

                function gatherExportData() {
                    const rows = [];
                    const headers = ['Description', 'Groupe', 'Type', 'Montant dû', 'Montant payé', 'Restant', 'Échéance', 'Statut'];
                    rows.push(headers);

                    document.querySelectorAll('#tableView tbody tr').forEach(row => {
                        const cols = row.querySelectorAll('td');
                        if (cols.length > 0) {
                            const rowData = [
                                cols[0].textContent.trim(),
                                cols[1].textContent.trim(),
                                cols[2].textContent.trim(),
                                cols[3].textContent.trim(),
                                cols[4].textContent.trim(),
                                cols[5].textContent.trim(),
                                cols[6].textContent.trim(),
                                cols[7].textContent.trim()
                            ];
                            rows.push(rowData);
                        }
                    });

                    return rows;
                }

                function downloadCSV(data, filename) {
                    const csv = data.map(row => row.join(',')).join('\n');
                    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    
                    if (link.download !== undefined) {
                        const url = URL.createObjectURL(blob);
                        link.setAttribute('href', url);
                        link.setAttribute('download', filename);
                        link.style.visibility = 'hidden';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                }

                // ==============================
                // Gestion des filtres avancés
                // ==============================
                function handlePeriodChange(selectElement) {
                    const value = selectElement.value;
                    const today = new Date();
                    let dateBegin, dateEnd;

                    switch(value) {
                        case 'this_month':
                            dateBegin = new Date(today.getFullYear(), today.getMonth(), 1);
                            dateEnd = new Date(today.getFullYear(), today.getMonth() + 1, 0);
                            break;
                        case 'last_month':
                            dateBegin = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                            dateEnd = new Date(today.getFullYear(), today.getMonth(), 0);
                            break;
                        case 'this_year':
                            dateBegin = new Date(today.getFullYear(), 0, 1);
                            dateEnd = new Date(today.getFullYear(), 11, 31);
                            break;
                        case 'overdue':
                            dateEnd = new Date(today.getTime() - 24 * 60 * 60 * 1000); // Hier
                            break;
                    }

                    // Mettre à jour les champs cachés si nécessaire
                    if (dateBegin || dateEnd) {
                        // Logique pour appliquer automatiquement les filtres
                        console.log('Période sélectionnée:', value, dateBegin, dateEnd);
                    }
                }

                // ==============================
                // Tooltips et interactions
                // ==============================
                function initializeTooltips() {
                    const truncatedElements = document.querySelectorAll('.text-truncate');
                    truncatedElements.forEach(el => {
                        if (el.scrollWidth > el.clientWidth) {
                            el.setAttribute('title', el.textContent);
                            new bootstrap.Tooltip(el);
                        }
                    });
                }

                // ==============================
                // Lazy loading
                // ==============================
                function initializeLazyLoading() {
                    const cards = document.querySelectorAll('.card');
                    const cardObserver = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                entry.target.classList.add('loaded');
                            }
                        });
                    });

                    cards.forEach(card => cardObserver.observe(card));
                }

                // ==============================
                // Raccourcis clavier
                // ==============================
                document.addEventListener('keydown', function(e) {
                    // Ctrl/Cmd + R : Actualiser
                    if ((e.ctrlKey || e.metaKey) &amp;&amp; e.key === 'r') {
                        e.preventDefault();
                        refreshDashboard();
                    }
                    
                    // Ctrl/Cmd + E : Exporter
                    if ((e.ctrlKey || e.metaKey) &amp;&amp; e.key === 'e') {
                        e.preventDefault();
                        exportCotisations();
                    }
                    
                    // Ctrl/Cmd + F : Ouvrir les filtres
                    if ((e.ctrlKey || e.metaKey) &amp;&amp; e.key === 'f') {
                        e.preventDefault();
                        const filterCollapse = document.getElementById('filterCollapse');
                        if (filterCollapse) {
                            const bsCollapse = new bootstrap.Collapse(filterCollapse);
                            bsCollapse.toggle();
                        }
                    }
                });

                // ==============================
                // Notification système
                // ==============================
                function showNotification(message, type = 'info') {
                    const notification = document.createElement('div');
                    notification.className = `alert alert-${type} notification-toast`;
                    notification.innerHTML = `
                        <div class="d-flex align-items-center">
                            <i class="fa fa-${type === 'success' ? 'check-circle' : 'info-circle'} me-2"></i>
                            <span>${message}</span>
                        </div>
                    `;
                    
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        notification.classList.add('show');
                    }, 100);
                    
                    setTimeout(() => {
                        notification.classList.remove('show');
                        setTimeout(() => notification.remove(), 300);
                    }, 3000);
                }

                // Fermer le menu FAB en cliquant ailleurs
                document.addEventListener('click', function(e) {
                    const fabContainer = document.querySelector('.fab-container');
                    if (fabContainer &amp;&amp; !fabContainer.contains(e.target)) {
                        fabContainer.classList.remove('open');
                    }
                });
            </script>

            <!-- ===============================
                 SECTION: Styles CSS intégrés
                 =============================== -->
            <style>
                /* Import du CSS principal depuis l'artifact séparé */
                @import url("contribution_management.enhanced_css_styles");
                
                /* Styles spécifiques à ce template */
                
                /* ==============================
                   FAB (Floating Action Buttons)
                   ============================== */
                .floating-action-buttons {
                    position: fixed;
                    bottom: 30px;
                    right: 30px;
                    z-index: 1000;
                }

                .fab-container {
                    position: relative;
                    display: flex;
                    flex-direction: column-reverse;
                    align-items: center;
                }

                .fab {
                    width: 56px;
                    height: 56px;
                    border-radius: 50%;
                    border: none;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    text-decoration: none;
                    color: white;
                    font-size: 20px;
                    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
                    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
                    cursor: pointer;
                }

                .fab-main {
                    background: linear-gradient(135deg, var(--primary-color), var(--info-color));
                    transform: scale(1);
                }

                .fab-main:hover {
                    transform: scale(1.1);
                    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
                }

                .fab-option {
                    background: linear-gradient(135deg, var(--gray-600), var(--gray-700));
                    margin-bottom: 16px;
                    opacity: 0;
                    transform: scale(0);
                    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
                    width: 48px;
                    height: 48px;
                    font-size: 16px;
                }

                .fab-container.open .fab-option {
                    opacity: 1;
                    transform: scale(1);
                }

                .fab-container.open .fab-option:nth-child(2) {
                    transition-delay: 0.1s;
                }

                .fab-container.open .fab-option:nth-child(3) {
                    transition-delay: 0.2s;
                }

                .fab-container.open .fab-option:nth-child(4) {
                    transition-delay: 0.3s;
                }

                .fab-container.open .fab-main {
                    transform: rotate(45deg) scale(1.1);
                }

                /* ==============================
                   Notifications toast
                   ============================== */
                .notification-toast {
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 1050;
                    min-width: 300px;
                    opacity: 0;
                    transform: translateX(100%);
                    transition: all 0.3s ease;
                    border: none;
                    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
                }

                .notification-toast.show {
                    opacity: 1;
                    transform: translateX(0);
                }

                /* ==============================
                   Progress bars améliorées
                   ============================== */
                .progress {
                    background-color: rgba(0, 0, 0, 0.1);
                    border-radius: 10px;
                    overflow: hidden;
                }

                .progress-bar {
                    transition: width 0.6s ease;
                    border-radius: 10px;
                    background: linear-gradient(90deg, currentColor, currentColor);
                    position: relative;
                }

                .progress-bar::after {
                    content: '';
                    position: absolute;
                    top: 0;
                    left: 0;
                    bottom: 0;
                    right: 0;
                    background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
                    animation: shimmer 2s infinite;
                }

                /* ==============================
                   États d'animation pour les cartes
                   ============================== */
                .card:not(.loaded) {
                    opacity: 0.7;
                    transform: translateY(20px);
                }

                .card.loaded {
                    opacity: 1;
                    transform: translateY(0);
                    transition: all 0.6s ease;
                }

                /* ==============================
                   Indicateurs d'état améliorés
                   ============================== */
                .state-indicator.paid::before {
                    animation: pulse 2s infinite;
                }

                .state-indicator.overdue::before {
                    animation: pulse 1s infinite;
                }

                /* ==============================
                   Boutons d'action améliorés
                   ============================== */
                .btn-group .btn {
                    position: relative;
                    overflow: hidden;
                }

                .btn-group .btn::after {
                    content: '';
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    width: 0;
                    height: 0;
                    background: rgba(255, 255, 255, 0.3);
                    border-radius: 50%;
                    transform: translate(-50%, -50%);
                    transition: all 0.3s ease;
                }

                .btn-group .btn:hover::after {
                    width: 120%;
                    height: 120%;
                }

                /* ==============================
                   Responsive pour FAB
                   ============================== */
                @media (max-width: 768px) {
                    .floating-action-buttons {
                        bottom: 20px;
                        right: 20px;
                    }
                    
                    .fab {
                        width: 48px;
                        height: 48px;
                        font-size: 18px;
                    }
                    
                    .fab-option {
                        width: 40px;
                        height: 40px;
                        font-size: 14px;
                    }
                }

                /* ==============================
                   Animation d'entrée personnalisée
                   ============================== */
                @keyframes slideInFromRight {
                    0% {
                        transform: translateX(100%);
                        opacity: 0;
                    }
                    100% {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }

                .slide-in-right {
                    animation: slideInFromRight 0.8s ease-out;
                }

                /* ==============================
                   Mode sombre pour ce template
                   ============================== */
                @media (prefers-color-scheme: dark) {
                    .dashboard-card.warning-card {
                        color: var(--dark-color);
                    }
                    
                    .fab-option {
                        background: linear-gradient(135deg, var(--gray-700), var(--gray-800));
                    }
                }

                /* ==============================
                   Améliorations d'accessibilité
                   ============================== */
                .fab:focus,
                .btn:focus {
                    outline: 3px solid var(--primary-light);
                    outline-offset: 2px;
                }

                @media (prefers-reduced-motion: reduce) {
                    * {
                        animation-duration: 0.01ms !important;
                        animation-iteration-count: 1 !important;
                        transition-duration: 0.01ms !important;
                    }
                }

                /* ==============================
                   États de chargement spécialisés
                   ============================== */
                .loading-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(255, 255, 255, 0.9);
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    z-index: 2000;
                    backdrop-filter: blur(5px);
                }

                .loading-spinner {
                    width: 3rem;
                    height: 3rem;
                    border: 0.3rem solid var(--gray-300);
                    border-top: 0.3rem solid var(--primary-color);
                    border-radius: 50%;
                    animation: spin 1s linear infinite;
                }

                /* ==============================
                   Print optimisations
                   ============================== */
                @media print {
                    .floating-action-buttons,
                    .fab-container,
                    .notification-toast {
                        display: none !important;
                    }
                    
                    .dashboard-card {
                        break-inside: avoid;
                        margin-bottom: 1rem;
                    }
                    
                    .card {
                        break-inside: avoid;
                    }
                }
            </style>
        </t>
    </template>

    <!-- ============================================
         TEMPLATE: Styles CSS séparés (à référencer)
         ============================================ -->
    <template id="enhanced_css_styles" name="Styles CSS Améliorés">
        <!-- Ce template contiendrait le contenu du CSS de l'artifact précédent -->
        <!-- Il est référencé par @import dans le style ci-dessus -->
    </template>

    <!-- ============================================
         TEMPLATE: Scripts JavaScript réutilisables
         ============================================ -->
    <template id="enhanced_js_scripts" name="Scripts JavaScript Améliorés">
        <!-- Scripts JavaScript modulaires pour réutilisation -->
    </template>

    <!-- ============================================
         SOUS-TEMPLATE: État vide
         ============================================ -->
    <template id="contribution_management.empty_state" name="État vide">
        <div class="text-center py-5">
            <div class="mb-4">
                <i class="fa fa-inbox fa-4x text-muted" />
            </div>
            <h5 class="text-muted mb-3">Aucune cotisation trouvée</h5>
            <p class="text-muted">Vous n'avez actuellement aucune cotisation associée à votre
                compte.</p>
            <a href="/my" class="btn btn-primary">
                <i class="fa fa-arrow-left me-1" /> Retour au tableau de bord </a>
        </div>
    </template>

    <!-- ============================================
         SOUS-TEMPLATE: Vue mobile
         ============================================ -->
    <template id="contribution_management.mobile_view" name="Vue mobile">
        <div class="d-md-none">
            <div class="row g-3">
                <div class="col-12" t-foreach="cotisations" t-as="cotisation">
                    <t t-call="contribution_management.mobile_card" />
                </div>
            </div>
        </div>
    </template>

    <!-- ============================================
         SOUS-TEMPLATE: Carte mobile
         ============================================ -->
    <template id="contribution_management.mobile_card" name="Carte mobile">
        <div class="card border-start border-4"
            t-att-class="'border-success' if cotisation.state == 'paid' 
                          else 'border-warning' if cotisation.state == 'partial' 
                          else 'border-danger' if cotisation.state == 'overdue' 
                          else 'border-secondary'">
            <div class="card-body p-3">
                <!-- En-tête de carte -->
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h6 class="card-title mb-1"
                        t-esc="cotisation.description or cotisation.display_name" />
                    <t t-call="contribution_management.status_badge" />
                </div>

                <!-- Informations de la cotisation -->
                <div class="row g-2 small text-muted">
                    <div class="col-6">
                        <strong>Groupe:</strong>
                        <br />
                        <span t-esc="cotisation.group_id.name" />
                    </div>
                    <div class="col-6">
                        <strong>Échéance:</strong>
                        <br />
                        <span t-field="cotisation.due_date" t-options="{'widget': 'date'}" />
                    </div>
                    <div class="col-6">
                        <strong>Montant dû:</strong>
                        <br />
                        <span t-field="cotisation.amount_due"
                            t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
                    </div>
                    <div class="col-6">
                        <strong>Restant:</strong>
                        <br />
                        <span t-field="cotisation.remaining_amount"
                            t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}"
                            t-att-class="'text-success fw-bold' if cotisation.remaining_amount == 0 else 'text-warning fw-bold'" />
                    </div>
                </div>

                <!-- Actions -->
                <div class="d-flex justify-content-end mt-3">
                    <t t-call="contribution_management.action_buttons" />
                </div>

                <!-- Indicateur de retard -->
                <t t-call="contribution_management.overdue_indicator" />
            </div>
        </div>
    </template>

    <!-- ============================================
         SOUS-TEMPLATE: Vue desktop
         ============================================ -->
    <template id="contribution_management.desktop_view" name="Vue desktop">
        <div class="d-none d-md-block">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead class="table-light">
                        <tr>
                            <th scope="col" class="border-0">
                                <i class="fa fa-file-text-o me-1" /> Description </th>
                            <th scope="col" class="border-0">
                                <i class="fa fa-users me-1" /> Groupe </th>
                            <th scope="col" class="border-0">
                                <i class="fa fa-tag me-1" /> Type </th>
                            <th scope="col" class="border-0 text-end">
                                <i class="fa fa-money me-1" /> Montant dû </th>
                            <th scope="col" class="border-0 text-end">
                                <i class="fa fa-check me-1" /> Payé </th>
                            <th scope="col" class="border-0 text-end">
                                <i class="fa fa-balance-scale me-1" /> Restant </th>
                            <th scope="col" class="border-0 text-center">
                                <i class="fa fa-calendar me-1" /> Échéance </th>
                            <th scope="col" class="border-0 text-center">
                                <i class="fa fa-info-circle me-1" /> Statut </th>
                            <th scope="col" class="border-0 text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="cotisations" t-as="cotisation">
                            <t t-call="contribution_management.desktop_row" />
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </template>

    <!-- ============================================
         SOUS-TEMPLATE: Ligne de tableau desktop
         ============================================ -->
    <template id="contribution_management.desktop_row" name="Ligne tableau desktop">
        <!-- Description -->
        <td class="align-middle">
            <div>
                <strong class="text-truncate d-block"
                    t-esc="cotisation.description or cotisation.display_name"
                    style="max-width: 200px;" />
                <t t-if="cotisation.days_overdue and cotisation.days_overdue > 0">
                    <small class="text-danger">
                        <i class="fa fa-exclamation-triangle me-1" /> En retard de <span
                            t-esc="cotisation.days_overdue" /> jour(s) </small>
                </t>
            </div>
        </td>

        <!-- Groupe -->
        <td class="align-middle">
            <span class="text-truncate d-block" t-esc="cotisation.group_id.name"
                style="max-width: 150px;" />
        </td>

        <!-- Type -->
        <td class="align-middle">
            <t t-call="contribution_management.type_badge" />
        </td>

        <!-- Montant dû -->
        <td class="align-middle text-end">
            <span class="fw-bold"
                t-field="cotisation.amount_due"
                t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
        </td>

        <!-- Montant payé -->
        <td class="align-middle text-end">
            <span class="text-success"
                t-field="cotisation.amount_paid"
                t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
        </td>

        <!-- Montant restant -->
        <td class="align-middle text-end">
            <span class="fw-bold"
                t-field="cotisation.remaining_amount"
                t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}"
                t-att-class="'text-success' if cotisation.remaining_amount == 0 else 'text-warning'" />
        </td>

        <!-- Échéance -->
        <td class="align-middle text-center">
            <div>
                <span t-field="cotisation.due_date" t-options="{'widget': 'date'}" />
                <t
                    t-if="cotisation.due_date and cotisation.due_date &lt; current_date and cotisation.state != 'paid'">
                    <br />
                    <small class="badge bg-danger">Échue</small>
                </t>
            </div>
        </td>

        <!-- Statut -->
        <td class="align-middle text-center">
            <t t-call="contribution_management.status_badge_detailed" />
        </td>

        <!-- Actions -->
        <td class="align-middle text-center">
            <t t-call="contribution_management.action_buttons" />
        </td>
    </template>

    <!-- ============================================
         SOUS-TEMPLATE: Badge de statut
         ============================================ -->
    <template id="contribution_management.status_badge" name="Badge de statut">
        <span class="badge"
            t-att-class="'bg-success' if cotisation.state == 'paid' 
                           else 'bg-warning' if cotisation.state == 'partial' 
                           else 'bg-danger' if cotisation.state == 'overdue' 
                           else 'bg-secondary'">
            <t t-if="cotisation.state == 'paid'">Payé</t>
            <t t-elif="cotisation.state == 'partial'">Partiel</t>
            <t t-elif="cotisation.state == 'overdue'">En retard</t>
            <t t-else="">En attente</t>
        </span>
    </template>

    <!-- ============================================
         SOUS-TEMPLATE: Badge de statut détaillé
         ============================================ -->
    <template id="contribution_management.status_badge_detailed" name="Badge de statut détaillé">
        <span class="badge fs-6"
            t-att-class="'bg-success' if cotisation.state == 'paid' 
                           else 'bg-warning text-dark' if cotisation.state == 'partial' 
                           else 'bg-danger' if cotisation.state == 'overdue' 
                           else 'bg-secondary'">
            <i class="fa fa-check me-1" t-if="cotisation.state == 'paid'" />
            <i class="fa fa-clock-o me-1" t-elif="cotisation.state == 'partial'" />
            <i class="fa fa-exclamation-triangle me-1" t-elif="cotisation.state == 'overdue'" />
            <i class="fa fa-pause me-1" t-else="" />
            <t t-if="cotisation.state == 'paid'">Payé</t>
            <t t-elif="cotisation.state == 'partial'">Partiel</t>
            <t t-elif="cotisation.state == 'overdue'">En retard</t>
            <t t-else="">En attente</t>
        </span>
    </template>

    <!-- ============================================
         SOUS-TEMPLATE: Badge de type
         ============================================ -->
    <template id="contribution_management.type_badge" name="Badge de type">
        <span class="badge"
            t-att-class="'bg-info' if cotisation.cotisation_type == 'monthly' else 'bg-primary'">
            <i class="fa fa-calendar me-1" t-if="cotisation.cotisation_type == 'monthly'" />
            <i class="fa fa-star me-1" t-else="" />
            <t t-if="cotisation.cotisation_type == 'monthly'">Mensuelle</t>
            <t t-else="">Activité</t>
        </span>
    </template>

    <!-- ============================================
         SOUS-TEMPLATE: Boutons d'action (CORRIGÉ)
         ============================================ -->
    <template id="contribution_management.action_buttons" name="Boutons d'action">
        <div class="btn-group btn-group-sm" role="group">
            <t
                t-if="cotisation.state in ['pending', 'partial', 'overdue'] and cotisation.remaining_amount > 0">
                <a t-attf-href="/my/cotisation/#{cotisation.id}/pay"
                    class="btn btn-primary">
                    <i class="fa fa-credit-card me-1" /> Payer </a>
            </t>
            <a t-attf-href="/my/cotisation/#{cotisation.id}"
                class="btn btn-outline-primary">
                <i class="fa fa-eye me-1" /> Voir </a>
        </div>
    </template>

    <!-- ============================================
         SOUS-TEMPLATE: Indicateur de retard
         ============================================ -->
    <template id="contribution_management.overdue_indicator" name="Indicateur de retard">
        <t t-if="cotisation.days_overdue and cotisation.days_overdue > 0">
            <div class="alert alert-danger alert-sm mt-2 mb-0 py-1 px-2">
                <i class="fa fa-exclamation-triangle me-1" />
                <small>En retard de <span t-esc="cotisation.days_overdue" /> jour(s)</small>
            </div>
        </t>
    </template>

    <!-- ============================================
         TEMPLATE: Formulaire de paiement de cotisation (COMPLET)
         ============================================ -->
    <template id="cotisation_payment_form" name="Formulaire de Paiement">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True" />

            <div class="o_portal_wrap">
                <div class="o_portal_my_doc o_portal_payment_form">
                    <div class="row">
                        <div class="col-12">

                            <!-- ===============================
                                 SECTION: Navigation (Breadcrumb)
                                 =============================== -->
                            <nav aria-label="breadcrumb" class="mb-4">
                                <ol class="breadcrumb bg-transparent p-0">
                                    <li class="breadcrumb-item">
                                        <a href="/my" class="text-decoration-none">
                                            <i class="fa fa-home me-1" /> Mon Compte
                                        </a>
                                    </li>
                                    <li class="breadcrumb-item">
                                        <a href="/my/cotisations" class="text-decoration-none">
                                            <i class="fa fa-list-alt me-1" /> Mes Cotisations
                                        </a>
                                    </li>
                                    <li class="breadcrumb-item">
                                        <a t-attf-href="/my/cotisation/#{cotisation.id}"
                                            class="text-decoration-none">
                                            <span t-esc="cotisation.display_name" />
                                        </a>
                                    </li>
                                    <li class="breadcrumb-item active" aria-current="page">
                                        <i class="fa fa-credit-card me-1" /> Paiement
                                    </li>
                                </ol>
                            </nav>

                            <!-- ===============================
                                 SECTION: Messages d'alerte
                                 =============================== -->
                            <t t-if="success_message">
                                <div class="alert alert-success alert-dismissible" role="alert">
                                    <div class="d-flex align-items-center">
                                        <i class="fa fa-check-circle me-2" />
                                        <div class="flex-grow-1">
                                            <strong>Succès !</strong>
                                            <span t-esc="success_message" />
                                        </div>
                                        <button type="button" class="btn-close"
                                            data-bs-dismiss="alert" aria-label="Fermer" />
                                    </div>
                                </div>
                            </t>

                            <t t-if="error_message">
                                <div class="alert alert-danger alert-dismissible" role="alert">
                                    <div class="d-flex align-items-center">
                                        <i class="fa fa-exclamation-triangle me-2" />
                                        <div class="flex-grow-1">
                                            <strong>Erreur !</strong>
                                            <span t-esc="error_message" />
                                        </div>
                                        <button type="button" class="btn-close"
                                            data-bs-dismiss="alert" aria-label="Fermer" />
                                    </div>
                                </div>
                            </t>

                            <!-- ===============================
                                 SECTION: En-tête du formulaire
                                 =============================== -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-body bg-primary text-white">
                                            <div class="row align-items-center">
                                                <div class="col-md-8">
                                                    <h2 class="card-title mb-1">
                                                        <i class="fa fa-credit-card me-2" />
                                                        Paiement de cotisation
                                                    </h2>
                                                    <p class="card-text mb-0">
                                                        <strong t-esc="cotisation.description or cotisation.display_name" />
                                                    </p>
                                                    <small class="opacity-75">
                                                        Groupe: <span t-esc="cotisation.group_id.name" />
                                                    </small>
                                                </div>
                                                <div class="col-md-4 text-end">
                                                    <div class="mb-1">
                                                        <small class="opacity-75">Montant restant</small>
                                                        <div class="h4 mb-0">
                                                            <span t-field="cotisation.remaining_amount"
                                                                t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
                                                        </div>
                                                    </div>
                                                    <small class="opacity-75">
                                                        Échéance: <span t-field="cotisation.due_date" t-options="{'widget': 'date'}" />
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ===============================
                                 SECTION: Formulaire principal
                                 =============================== -->
                            <div class="row">
                                <div class="col-lg-8">
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-header bg-white border-0">
                                            <h5 class="mb-0 text-primary">
                                                <i class="fa fa-edit me-2" /> Informations de paiement
                                            </h5>
                                        </div>
                                        <div class="card-body">
                                            <form t-attf-action="/my/cotisation/#{cotisation.id}/submit_payment"
                                                method="post" enctype="multipart/form-data"
                                                class="needs-validation" novalidate="true">
                                                
                                                <!-- Token CSRF -->
                                                <input type="hidden" name="csrf_token" 
                                                    t-att-value="request.csrf_token()" />
                                                <input type="hidden" name="access_token" 
                                                    t-att-value="access_token" t-if="access_token" />

                                                <!-- Montant du paiement -->
                                                <div class="row mb-3">
                                                    <div class="col-md-6">
                                                        <label for="amount" class="form-label">
                                                            <i class="fa fa-money me-1 text-success" />
                                                            Montant du paiement <span class="text-danger">*</span>
                                                        </label>
                                                        <div class="input-group">
                                                            <input type="number" step="0.01" min="0.01"
                                                                t-att-max="cotisation.remaining_amount * 1.1"
                                                                class="form-control form-control-lg"
                                                                id="amount" name="amount"
                                                                t-att-value="cotisation.remaining_amount"
                                                                placeholder="0.00" required="true" />
                                                            <span class="input-group-text">
                                                                <span t-esc="cotisation.currency_id.symbol or 'FCFA'" />
                                                            </span>
                                                            <div class="invalid-feedback">
                                                                Veuillez saisir un montant valide.
                                                            </div>
                                                        </div>
                                                        <small class="form-text text-muted">
                                                            Maximum autorisé: <span t-field="cotisation.remaining_amount"
                                                                t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
                                                            + 10%
                                                        </small>
                                                    </div>

                                                    <div class="col-md-6">
                                                        <label for="payment_date" class="form-label">
                                                            <i class="fa fa-calendar me-1 text-info" />
                                                            Date de paiement <span class="text-danger">*</span>
                                                        </label>
                                                        <input type="date" class="form-control form-control-lg"
                                                            id="payment_date" name="payment_date"
                                                            t-att-value="current_date.strftime('%Y-%m-%d')"
                                                            t-att-max="current_date.strftime('%Y-%m-%d')"
                                                            required="true" />
                                                        <div class="invalid-feedback">
                                                            La date de paiement est requise et ne peut pas être future.
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Méthode de paiement -->
                                                <div class="mb-3">
                                                    <label for="payment_method" class="form-label">
                                                        <i class="fa fa-credit-card me-1 text-primary" />
                                                        Méthode de paiement <span class="text-danger">*</span>
                                                    </label>
                                                    <select class="form-select form-select-lg" 
                                                        id="payment_method" name="payment_method" required="true">
                                                        <option value="">-- Choisir une méthode --</option>
                                                        <t t-foreach="payment_methods" t-as="method">
                                                            <option t-att-value="method[0]" t-esc="method[1]" />
                                                        </t>
                                                    </select>
                                                    <div class="invalid-feedback">
                                                        Veuillez sélectionner une méthode de paiement.
                                                    </div>
                                                </div>

                                                <!-- Référence -->
                                                <div class="mb-3">
                                                    <label for="reference" class="form-label">
                                                        <i class="fa fa-hashtag me-1 text-secondary" />
                                                        Référence/Numéro de transaction
                                                    </label>
                                                    <input type="text" class="form-control form-control-lg"
                                                        id="reference" name="reference" maxlength="100"
                                                        placeholder="Ex: TXN123456, REF-001..." />
                                                    <small class="form-text text-muted">
                                                        Numéro de transaction, référence de virement, etc. (optionnel)
                                                    </small>
                                                </div>

                                                <!-- Justificatif -->
                                                <div class="mb-3">
                                                    <label for="proof_file" class="form-label">
                                                        <i class="fa fa-file-image-o me-1 text-warning" />
                                                        Justificatif de paiement (optionnel)
                                                    </label>
                                                    <input type="file" class="form-control form-control-lg"
                                                        id="proof_file" name="proof_file"
                                                        accept="image/*,.pdf,.doc,.docx,.xls,.xlsx" />
                                                    <div class="form-text">
                                                        <small class="text-muted">
                                                            <strong>Formats acceptés:</strong> <span t-esc="allowed_file_types" />
                                                            | <strong>Taille max:</strong> <span t-esc="max_file_size" />MB
                                                        </small>
                                                    </div>
                                                </div>

                                                <!-- Notes -->
                                                <div class="mb-4">
                                                    <label for="notes" class="form-label">
                                                        <i class="fa fa-comment me-1 text-muted" />
                                                        Commentaires
                                                    </label>
                                                    <textarea class="form-control" id="notes" name="notes" rows="3"
                                                        maxlength="500"
                                                        placeholder="Ajoutez des commentaires sur ce paiement (optionnel)..."></textarea>
                                                    <small class="form-text text-muted">
                                                        Maximum 500 caractères
                                                    </small>
                                                </div>

                                                <!-- Zone d'information importante -->
                                                <div class="alert alert-info" role="alert">
                                                    <div class="d-flex">
                                                        <i class="fa fa-info-circle me-2 mt-1"></i>
                                                        <div>
                                                            <strong>Important :</strong>
                                                            <ul class="mb-0 mt-1">
                                                                <li>Votre justificatif sera vérifié par notre équipe</li>
                                                                <li>Vous recevrez une notification de validation par email</li>
                                                                <li>En cas de rejet, vous pourrez soumettre un nouveau justificatif</li>
                                                                <li>Pour les paiements urgents, contactez-nous directement</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Boutons d'action -->
                                                <div class="d-flex justify-content-between">
                                                    <a t-attf-href="/my/cotisation/#{cotisation.id}" 
                                                        class="btn btn-outline-secondary btn-lg">
                                                        <i class="fa fa-arrow-left me-1" /> Retour
                                                    </a>
                                                    <button type="submit" class="btn btn-primary btn-lg">
                                                        <i class="fa fa-paper-plane me-1" /> Soumettre le paiement
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                                <!-- ===============================
                                     SECTION: Informations latérales
                                     =============================== -->
                                <div class="col-lg-4">
                                    <!-- Récapitulatif -->
                                    <div class="card border-0 shadow-sm mb-4">
                                        <div class="card-header bg-white border-0">
                                            <h6 class="mb-0 text-primary">
                                                <i class="fa fa-summary me-2" /> Récapitulatif
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-3">
                                                <div class="col-12">
                                                    <small class="text-muted">Description</small><br />
                                                    <strong t-esc="cotisation.description or cotisation.display_name" />
                                                </div>
                                                <div class="col-6">
                                                    <small class="text-muted">Montant total</small><br />
                                                    <span t-field="cotisation.amount_due"
                                                        t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
                                                </div>
                                                <div class="col-6">
                                                    <small class="text-muted">Déjà payé</small><br />
                                                    <span class="text-success" t-field="cotisation.amount_paid"
                                                        t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
                                                </div>
                                                <div class="col-12">
                                                    <hr class="my-2" />
                                                    <small class="text-muted">Reste à payer</small><br />
                                                    <strong class="text-primary h6" t-field="cotisation.remaining_amount"
                                                        t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Méthodes de paiement acceptées -->
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-header bg-white border-0">
                                            <h6 class="mb-0 text-primary">
                                                <i class="fa fa-credit-card me-2" /> Méthodes acceptées
                                            </h6>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-2">
                                                <div class="col-6">
                                                    <div class="d-flex align-items-center mb-2">
                                                        <i class="fa fa-mobile text-success me-2" />
                                                        <div>
                                                            <small><strong>Mobile Money</strong></small><br />
                                                            <small class="text-muted">Orange, MTN, etc.</small>
                                                        </div>
                                                    </div>
                                                    <div class="d-flex align-items-center">
                                                        <i class="fa fa-university text-primary me-2" />
                                                        <div>
                                                            <small><strong>Virement</strong></small><br />
                                                            <small class="text-muted">Transfert bancaire</small>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-6">
                                                    <div class="d-flex align-items-center mb-2">
                                                        <i class="fa fa-money text-success me-2" />
                                                        <div>
                                                            <small><strong>Espèces</strong></small><br />
                                                            <small class="text-muted">Paiement liquide</small>
                                                        </div>
                                                    </div>
                                                    <div class="d-flex align-items-center">
                                                        <i class="fa fa-credit-card text-info me-2" />
                                                        <div>
                                                            <small><strong>Carte</strong></small><br />
                                                            <small class="text-muted">Visa, Mastercard</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===============================
                 SECTION: Scripts JavaScript
                 =============================== -->
            <script type="text/javascript">
                document.addEventListener('DOMContentLoaded', function() {
                    // ==============================
                    // Validation Bootstrap
                    // ==============================
                    const forms = document.querySelectorAll('.needs-validation');
                    Array.prototype.slice.call(forms).forEach(function(form) {
                        form.addEventListener('submit', function(event) {
                            if (!form.checkValidity()) {
                                event.preventDefault();
                                event.stopPropagation();
                            }
                            form.classList.add('was-validated');
                        }, false);
                    });

                    // ==============================
                    // Validation du montant
                    // ==============================
                    const amountInput = document.getElementById('amount');
                    if (amountInput) {
                        const maxAmount = parseFloat(amountInput.getAttribute('max'));
                        const minAmount = parseFloat(amountInput.getAttribute('min'));
                        
                        amountInput.addEventListener('input', function() {
                            const value = parseFloat(this.value);
                            const feedbackElement = this.parentNode.querySelector('.invalid-feedback');
                            
                            if (isNaN(value) || value &lt;= 0) {
                                this.setCustomValidity('Le montant doit être positif');
                                feedbackElement.textContent = 'Le montant doit être positif';
                            } else if (value > maxAmount) {
                                this.setCustomValidity('Le montant ne peut pas dépasser le montant restant de plus de 10%');
                                feedbackElement.textContent = 'Le montant ne peut pas dépasser le montant restant de plus de 10%';
                            } else if (value &lt; minAmount) {
                                this.setCustomValidity('Le montant minimum est de ' + minAmount);
                                feedbackElement.textContent = 'Le montant minimum est de ' + minAmount;
                            } else {
                                this.setCustomValidity('');
                                feedbackElement.textContent = 'Veuillez saisir un montant valide';
                            }
                        });
                    }

                    // ==============================
                    // Validation de la date
                    // ==============================
                    const dateInput = document.getElementById('payment_date');
                    if (dateInput) {
                        const today = new Date().toISOString().split('T')[0];
                        
                        dateInput.addEventListener('change', function() {
                            if (this.value > today) {
                                this.setCustomValidity('La date de paiement ne peut pas être dans le futur');
                            } else {
                                this.setCustomValidity('');
                            }
                        });
                    }

                    // ==============================
                    // Validation du fichier
                    // ==============================
                    const fileInput = document.getElementById('proof_file');
                    if (fileInput) {
                        const maxSizeMB = 10; // Size is passed from controller
                        const allowedTypes = [
                            'image/jpeg', 'image/png', 'image/gif', 'image/bmp', 'image/webp',
                            'application/pdf',
                            'application/msword',
                            'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                            'application/vnd.ms-excel',
                            'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
                        ];

                        fileInput.addEventListener('change', function() {
                            if (this.files.length > 0) {
                                const file = this.files[0];
                                const fileSizeMB = file.size / (1024 * 1024);

                                // Vérification de la taille
                                if (fileSizeMB > maxSizeMB) {
                                    alert(`Le fichier est trop volumineux. Taille maximum: ${maxSizeMB}MB`);
                                    this.value = '';
                                    return;
                                }

                                // Vérification du type
                                if (!allowedTypes.includes(file.type)) {
                                    alert('Type de fichier non autorisé. Veuillez choisir un fichier JPG, PNG, PDF, DOC ou DOCX.');
                                    this.value = '';
                                    return;
                                }
                            }
                        });
                    }

                    // ==============================
                    // Compteur de caractères
                    // ==============================
                    const notesTextarea = document.getElementById('notes');
                    if (notesTextarea) {
                        const maxLength = parseInt(notesTextarea.getAttribute('maxlength'));
                        
                        // Créer l'élément de compteur
                        const counterElement = document.createElement('small');
                        counterElement.className = 'form-text text-muted float-end';
                        counterElement.textContent = `0/${maxLength}`;
                        notesTextarea.parentNode.appendChild(counterElement);

                        notesTextarea.addEventListener('input', function() {
                            const currentLength = this.value.length;
                            counterElement.textContent = `${currentLength}/${maxLength}`;
                            
                            if (currentLength > maxLength * 0.9) {
                                counterElement.classList.remove('text-muted');
                                counterElement.classList.add('text-warning');
                            } else {
                                counterElement.classList.remove('text-warning');
                                counterElement.classList.add('text-muted');
                            }
                        });
                    }

                    // ==============================
                    // Animation de soumission
                    // ==============================
                    const submitButton = document.querySelector('button[type="submit"]');
                    if (submitButton) {
                        const form = submitButton.closest('form');
                        const originalText = submitButton.innerHTML;
                        
                        form.addEventListener('submit', function(event) {
                            if (this.checkValidity()) {
                                submitButton.disabled = true;
                                submitButton.innerHTML = '<i class="fa fa-spinner fa-spin me-1"></i> Traitement en cours...';
                                
                                // Afficher un message de patience
                                const alertDiv = document.createElement('div');
                                alertDiv.className = 'alert alert-info mt-3';
                                alertDiv.innerHTML = '<i class="fa fa-info-circle me-2"></i>Traitement en cours, veuillez patienter...';
                                this.appendChild(alertDiv);
                                
                                // Timeout de sécurité
                                setTimeout(function() {
                                    submitButton.disabled = false;
                                    submitButton.innerHTML = originalText;
                                    if (alertDiv.parentNode) {
                                        alertDiv.remove();
                                    }
                                }, 30000); // 30 secondes
                            }
                        });
                    }

                    // ==============================
                    // Amélioration UX: focus automatique
                    // ==============================
                    if (amountInput &amp;&amp; !amountInput.value) {
                        amountInput.focus();
                    }
                });
            </script>

            <!-- ===============================
                 SECTION: Styles CSS
                 =============================== -->
            <style>
                /* ==============================
                   States &amp; Focus
                   ============================== */
                .form-control:focus,
                .form-select:focus {
                    border-color: #0d6efd;
                    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
                }

                /* ==============================
                   Validation States
                   ============================== */
                .was-validated .form-control:valid,
                .was-validated .form-select:valid {
                    border-color: #198754;
                    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='m2.3 6.73.94-.94 1.78 1.78L7.5 5.09l.94.94L5.5 8.5z'/%3e%3c/svg%3e");
                    background-repeat: no-repeat;
                    background-position: right calc(0.375em + 0.1875rem) center;
                    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
                }

                .was-validated .form-control:invalid,
                .was-validated .form-select:invalid {
                    border-color: #dc3545;
                    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 4.6.7.7 1.4-1.4.7.7-1.4 1.4.7.7-1.4 1.4-.7-.7 1.4-1.4-.7-.7-1.4 1.4-.7-.7 1.4-1.4z'/%3e%3c/svg%3e");
                    background-repeat: no-repeat;
                    background-position: right calc(0.375em + 0.1875rem) center;
                    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
                }

                /* ==============================
                   Input Groups
                   ============================== */
                .input-group .form-control:focus {
                    z-index: 3;
                }

                .input-group-text {
                    background-color: #f8f9fa;
                    border-color: #ced4da;
                }

                /* ==============================
                   File Input
                   ============================== */
                .form-control[type="file"] {
                    padding: 0.5rem 0.75rem;
                }

                .form-control[type="file"]::-webkit-file-upload-button {
                    padding: 0.375rem 0.75rem;
                    margin: -0.375rem -0.75rem;
                    margin-inline-end: 0.75rem;
                    background-color: #e9ecef;
                    border: 0;
                    border-radius: 0.375rem 0 0 0.375rem;
                }

                /* ==============================
                   Cards &amp; Animations
                   ============================== */
                .card {
                    transition: box-shadow 0.15s ease-in-out;
                }

                .card:hover {
                    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
                }

                .btn {
                    transition: all 0.15s ease-in-out;
                }

                .btn:hover {
                    transform: translateY(-1px);
                }

                /* ==============================
                   Alert Improvements
                   ============================== */
                .alert {
                    border: none;
                    border-radius: 0.5rem;
                }

                .alert-info {
                    background-color: #e7f3ff;
                    color: #055160;
                    border-left: 4px solid #0dcaf0;
                }

                /* ==============================
                   Breadcrumb
                   ============================== */
                .breadcrumb-item + .breadcrumb-item::before {
                    color: #6c757d;
                }

                .breadcrumb-item.active {
                    color: #6c757d;
                }

                /* ==============================
                   Progress &amp; Loading States
                   ============================== */
                .btn:disabled {
                    opacity: 0.65;
                    cursor: not-allowed;
                }

                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }

                .fa-spin {
                    animation: spin 1s linear infinite;
                }

                /* ==============================
                   Form Enhancements
                   ============================== */
                .form-label {
                    font-weight: 600;
                    margin-bottom: 0.5rem;
                }

                .form-control-lg {
                    font-size: 1.1rem;
                }

                /* ==============================
                   Responsive Design
                   ============================== */
                @media (max-width: 768px) {
                    .card-body {
                        padding: 1rem;
                    }

                    .btn-lg {
                        font-size: 1rem;
                        padding: 0.75rem 1.5rem;
                    }

                    .h4 {
                        font-size: 1.25rem;
                    }

                    .row.g-3 > .col-md-6 {
                        margin-bottom: 1rem;
                    }
                }

                /* ==============================
                   Print Styles
                   ============================== */
                @media print {
                    .btn, .alert-dismissible .btn-close {
                        display: none;
                    }
                    
                    .card {
                        box-shadow: none;
                        border: 1px solid #ddd;
                    }
                }
            </style>
        </t>
    </template>

    <!-- ============================================
         TEMPLATE: Page de confirmation après soumission
         ============================================ -->
    <template id="payment_confirmation" name="Confirmation de Paiement">
        <t t-call="portal.portal_layout">
            <div class="o_portal_wrap">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <!-- Message de succès -->
                            <div class="text-center py-5">
                                <div class="mb-4">
                                    <i class="fa fa-check-circle fa-5x text-success"></i>
                                </div>
                                
                                <h1 class="display-6 text-success mb-3">Paiement soumis !</h1>
                                
                                <p class="lead mb-4">
                                    Votre justificatif de paiement a été soumis avec succès. 
                                    Notre équipe le validera dans les plus brefs délais.
                                </p>

                                <!-- Informations sur le paiement -->
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <small class="text-muted">Cotisation</small><br />
                                                <strong t-esc="cotisation.display_name" />
                                            </div>
                                            <div class="col-md-6">
                                                <small class="text-muted">Montant soumis</small><br />
                                                <strong class="text-success" t-field="payment_proof.amount"
                                                    t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
                                            </div>
                                            <div class="col-md-6">
                                                <small class="text-muted">Méthode</small><br />
                                                <span t-esc="dict(payment_methods).get(payment_proof.payment_method, payment_proof.payment_method)" />
                                            </div>
                                            <div class="col-md-6">
                                                <small class="text-muted">Date de soumission</small><br />
                                                <span t-field="payment_proof.create_date" t-options="{'widget': 'datetime'}" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Prochaines étapes -->
                                <div class="alert alert-info text-start">
                                    <h6><i class="fa fa-info-circle me-2"></i>Que se passe-t-il maintenant ?</h6>
                                    <ol class="mb-0">
                                        <li>Notre équipe va vérifier votre justificatif</li>
                                        <li>Vous recevrez un email de confirmation ou de demande de clarification</li>
                                        <li>Une fois validé, votre cotisation sera mise à jour</li>
                                        <li>En cas de problème, vous pourrez soumettre un nouveau justificatif</li>
                                    </ol>
                                </div>

                                <!-- Actions -->
                                <div class="d-flex flex-wrap justify-content-center gap-3">
                                    <a t-attf-href="/my/cotisation/#{cotisation.id}" class="btn btn-primary">
                                        <i class="fa fa-eye me-1"></i> Voir la cotisation
                                    </a>
                                    <a href="/my/cotisations" class="btn btn-outline-secondary">
                                        <i class="fa fa-list me-1"></i> Mes cotisations
                                    </a>
                                    <a href="/my/cotisations/history" class="btn btn-outline-info">
                                        <i class="fa fa-history me-1"></i> Historique des paiements
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- ============================================
         TEMPLATE: Page d'erreur d'accès
         ============================================ -->
    <template id="cotisation_access_denied" name="Accès refusé">
        <t t-call="portal.portal_layout">
            <div class="o_portal_wrap">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-6">
                            <div class="text-center py-5">
                                <div class="mb-4">
                                    <i class="fa fa-lock fa-5x text-warning"></i>
                                </div>
                                
                                <h1 class="display-6 text-warning mb-3">Accès refusé</h1>
                                
                                <p class="lead mb-4">
                                    Vous n'avez pas l'autorisation d'accéder à cette cotisation.
                                </p>

                                <div class="d-flex justify-content-center gap-3">
                                    <a href="/my/cotisations" class="btn btn-primary">
                                        <i class="fa fa-list me-1"></i> Mes cotisations
                                    </a>
                                    <a href="/my" class="btn btn-outline-secondary">
                                        <i class="fa fa-home me-1"></i> Mon compte
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- ============================================
         TEMPLATE: Cotisation non trouvée
         ============================================ -->
    <template id="cotisation_not_found" name="Cotisation non trouvée">
        <t t-call="portal.portal_layout">
            <div class="o_portal_wrap">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-6">
                            <div class="text-center py-5">
                                <div class="mb-4">
                                    <i class="fa fa-search fa-5x text-muted"></i>
                                </div>
                                
                                <h1 class="display-6 text-muted mb-3">Cotisation non trouvée</h1>
                                
                                <p class="lead mb-4">
                                    La cotisation que vous recherchez n'existe pas ou n'est plus disponible.
                                </p>

                                <div class="d-flex justify-content-center gap-3">
                                    <a href="/my/cotisations" class="btn btn-primary">
                                        <i class="fa fa-list me-1"></i> Mes cotisations
                                    </a>
                                    <a href="/my" class="btn btn-outline-secondary">
                                        <i class="fa fa-home me-1"></i> Mon compte
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- ============================================
         TEMPLATE: Historique des paiements
         ============================================ -->
    <template id="payment_history" name="Historique des Paiements">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True" />

            <t t-call="portal.portal_searchbar">
                <t t-set="title">Historique des Paiements</t>
            </t>

            <div class="o_portal_wrap">
                <div class="o_portal_my_doc o_portal_payment_history">
                    <div class="row">
                        <div class="col-12">

                            <!-- Navigation -->
                            <nav aria-label="breadcrumb" class="mb-4">
                                <ol class="breadcrumb bg-transparent p-0">
                                    <li class="breadcrumb-item">
                                        <a href="/my" class="text-decoration-none">
                                            <i class="fa fa-home me-1" /> Mon Compte
                                        </a>
                                    </li>
                                    <li class="breadcrumb-item">
                                        <a href="/my/cotisations" class="text-decoration-none">
                                            <i class="fa fa-list-alt me-1" /> Mes Cotisations
                                        </a>
                                    </li>
                                    <li class="breadcrumb-item active" aria-current="page">
                                        <i class="fa fa-history me-1" /> Historique des paiements
                                    </li>
                                </ol>
                            </nav>

                            <!-- Statistiques -->
                            <div class="row mb-4">
                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="card border-0 shadow-sm h-100">
                                        <div class="card-body text-center bg-primary text-white rounded">
                                            <i class="fa fa-paper-plane fa-2x mb-2" />
                                            <h3 class="card-title mb-1" t-esc="total_submitted" />
                                            <p class="card-text small mb-0">Total soumis</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="card border-0 shadow-sm h-100">
                                        <div class="card-body text-center bg-success text-white rounded">
                                            <i class="fa fa-check-circle fa-2x mb-2" />
                                            <h3 class="card-title mb-1" t-esc="validated_payments" />
                                            <p class="card-text small mb-0">Validés</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="card border-0 shadow-sm h-100">
                                        <div class="card-body text-center bg-warning text-white rounded">
                                            <i class="fa fa-clock-o fa-2x mb-2" />
                                            <h3 class="card-title mb-1" t-esc="pending_payments" />
                                            <p class="card-text small mb-0">En attente</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-lg-3 col-md-6 mb-3">
                                    <div class="card border-0 shadow-sm h-100">
                                        <div class="card-body text-center bg-danger text-white rounded">
                                            <i class="fa fa-times-circle fa-2x mb-2" />
                                            <h3 class="card-title mb-1" t-esc="rejected_payments" />
                                            <p class="card-text small mb-0">Rejetés</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Liste des paiements -->
                            <div class="card border-0 shadow-sm">
                                <div class="card-header bg-white border-0">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h4 class="mb-0 text-primary">
                                            <i class="fa fa-history me-2" /> Historique des justificatifs
                                        </h4>
                                    </div>
                                </div>

                                <div class="card-body">
                                    <t t-if="not payment_proofs">
                                        <div class="text-center py-5">
                                            <i class="fa fa-inbox fa-4x text-muted" />
                                            <h5 class="text-muted mb-3 mt-3">Aucun paiement trouvé</h5>
                                            <p class="text-muted">Vous n'avez encore soumis aucun justificatif de paiement.</p>
                                            <a href="/my/cotisations" class="btn btn-primary">
                                                <i class="fa fa-plus me-1" /> Soumettre un paiement
                                            </a>
                                        </div>
                                    </t>

                                    <t t-else="">
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>Date de soumission</th>
                                                        <th>Cotisation</th>
                                                        <th>Montant</th>
                                                        <th>Méthode</th>
                                                        <th>Référence</th>
                                                        <th>Statut</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr t-foreach="payment_proofs" t-as="proof">
                                                        <td>
                                                            <span t-field="proof.create_date" t-options="{'widget': 'datetime'}" />
                                                        </td>
                                                        <td>
                                                            <strong t-esc="proof.cotisation_id.display_name" />
                                                            <br />
                                                            <small class="text-muted" t-esc="proof.cotisation_id.group_id.name" />
                                                        </td>
                                                        <td>
                                                            <span t-field="proof.amount"
                                                                t-options="{'widget': 'monetary', 'display_currency': proof.cotisation_id.currency_id}" />
                                                        </td>
                                                        <td>
                                                            <t t-if="proof.payment_method == 'mobile_money'">
                                                                <i class="fa fa-mobile text-success me-1" />Mobile Money
                                                            </t>
                                                            <t t-elif="proof.payment_method == 'bank_transfer'">
                                                                <i class="fa fa-university text-primary me-1" />Virement
                                                            </t>
                                                            <t t-elif="proof.payment_method == 'cash'">
                                                                <i class="fa fa-money text-success me-1" />Espèces
                                                            </t>
                                                            <t t-elif="proof.payment_method == 'card'">
                                                                <i class="fa fa-credit-card text-info me-1" />Carte
                                                            </t>
                                                            <t t-else="">
                                                                <i class="fa fa-question-circle text-muted me-1" />Autre
                                                            </t>
                                                        </td>
                                                        <td>
                                                            <span class="text-monospace" t-esc="proof.reference or '-'" />
                                                        </td>
                                                        <td>
                                                            <span class="badge"
                                                                t-att-class="'bg-success' if proof.state == 'validated' 
                                                                           else 'bg-danger' if proof.state == 'rejected' 
                                                                           else 'bg-warning text-dark'">
                                                                <t t-if="proof.state == 'validated'">
                                                                    <i class="fa fa-check me-1" />Validé
                                                                </t>
                                                                <t t-elif="proof.state == 'rejected'">
                                                                    <i class="fa fa-times me-1" />Rejeté
                                                                </t>
                                                                <t t-else="">
                                                                    <i class="fa fa-clock-o me-1" />En attente
                                                                </t>
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <div class="btn-group btn-group-sm">
                                                                <a t-attf-href="/my/cotisation/#{proof.cotisation_id.id}"
                                                                    class="btn btn-outline-primary" title="Voir la cotisation">
                                                                    <i class="fa fa-eye" />
                                                                </a>
                                                                <t t-if="proof.proof_file">
                                                                    <a t-attf-href="/my/cotisation/proof/#{proof.id}/download"
                                                                        class="btn btn-outline-secondary" title="Télécharger le justificatif">
                                                                        <i class="fa fa-download" />
                                                                    </a>
                                                                </t>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </t>
                                </div>
                            </div>

                            <!-- Pagination -->
                            <t t-if="pager and pager.get('page_count', 0) > 1">
                                <t t-call="portal.pager" />
                            </t>

                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- ============================================
         TEMPLATE: Page de détail de cotisation
         ============================================ -->
    <!-- ============================================
     TEMPLATE: Page de détail de cotisation (CORRIGÉ)
     ============================================ -->
    <template id="cotisation_detail" name="Détail de Cotisation">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True" />

            <div class="o_portal_wrap">
                <div class="o_portal_my_doc o_portal_cotisation_detail">
                    <div class="row">
                        <div class="col-12">

                            <!-- ===============================
                             SECTION: Navigation (Breadcrumb)
                             =============================== -->
                            <nav aria-label="breadcrumb" class="mb-4">
                                <ol class="breadcrumb bg-transparent p-0">
                                    <li class="breadcrumb-item">
                                        <a href="/my" class="text-decoration-none">
                                            <i class="fa fa-home me-1" /> Mon Compte </a>
                                    </li>
                                    <li class="breadcrumb-item">
                                        <a href="/my/cotisations" class="text-decoration-none">
                                            <i class="fa fa-list-alt me-1" /> Mes Cotisations </a>
                                    </li>
                                    <li class="breadcrumb-item active" aria-current="page">
                                        <span t-esc="cotisation.display_name" />
                                    </li>
                                </ol>
                            </nav>

                            <!-- ===============================
                             SECTION: Messages d'alerte
                             =============================== -->
                            <t t-if="success_message">
                                <div class="alert alert-success alert-dismissible" role="alert">
                                    <div class="d-flex align-items-center">
                                        <i class="fa fa-check-circle me-2" />
                                        <div class="flex-grow-1">
                                            <strong>Succès !</strong>
                                            <span t-esc="success_message" />
                                        </div>
                                        <button type="button" class="btn-close"
                                            data-bs-dismiss="alert" aria-label="Fermer" />
                                    </div>
                                </div>
                            </t>

                            <t t-if="error_message">
                                <div class="alert alert-danger alert-dismissible" role="alert">
                                    <div class="d-flex align-items-center">
                                        <i class="fa fa-exclamation-triangle me-2" />
                                        <div class="flex-grow-1">
                                            <strong>Erreur !</strong>
                                            <span t-esc="error_message" />
                                        </div>
                                        <button type="button" class="btn-close"
                                            data-bs-dismiss="alert" aria-label="Fermer" />
                                    </div>
                                </div>
                            </t>

                            <!-- ===============================
                             SECTION: En-tête de la cotisation
                             =============================== -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-body">
                                            <div class="row align-items-center">

                                                <!-- Informations principales -->
                                                <div class="col-md-8">
                                                    <h2 class="card-title text-primary mb-1">
                                                        <i class="fa fa-file-text-o me-2" />
                                                        <span
                                                            t-esc="cotisation.description or cotisation.display_name" />
                                                    </h2>

                                                    <p class="card-text text-muted mb-2"> Groupe: <strong
                                                            t-esc="cotisation.group_id.name" />
                                                    </p>

                                                    <div class="d-flex align-items-center">
                                                        <!-- Badge de statut -->
                                                        <span class="badge me-2"
                                                            t-att-class="'bg-success' if cotisation.state == 'paid' 
                                                                       else 'bg-warning text-dark' if cotisation.state == 'partial' 
                                                                       else 'bg-danger' if cotisation.state == 'overdue' 
                                                                       else 'bg-secondary'">
                                                            <t t-if="cotisation.state == 'paid'">
                                                                Payé</t>
                                                            <t
                                                                t-elif="cotisation.state == 'partial'">
                                                                Partiel</t>
                                                            <t
                                                                t-elif="cotisation.state == 'overdue'">En
                                                                retard</t>
                                                            <t t-else="">En attente</t>
                                                        </span>

                                                        <!-- Date d'échéance -->
                                                        <small class="text-muted"> Échéance: <span
                                                                t-field="cotisation.due_date"
                                                                t-options="{'widget': 'date'}" />
                                                        </small>
                                                    </div>
                                                </div>

                                                <!-- Montant et actions -->
                                                <div class="col-md-4 text-end">
                                                    <div class="mb-2">
                                                        <small class="text-muted">Montant restant</small>
                                                        <div class="h4 mb-0"
                                                            t-att-class="'text-success' if cotisation.remaining_amount == 0 else 'text-warning'">
                                                            <span
                                                                t-field="cotisation.remaining_amount"
                                                                t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
                                                        </div>
                                                    </div>

                                                    <t t-if="can_pay">
                                                        <a
                                                            t-attf-href="/my/cotisation/#{cotisation.id}/pay"
                                                            class="btn btn-primary">
                                                            <i class="fa fa-credit-card me-1" />
                                                            Payer maintenant </a>
                                                    </t>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ===============================
                             SECTION: Détails et Actions
                             =============================== -->
                            <div class="row">

                                <!-- Colonne gauche: Détails -->
                                <div class="col-md-6">
                                    <div class="card border-0 shadow-sm mb-4">
                                        <div class="card-header bg-white border-0">
                                            <h5 class="mb-0 text-primary">
                                                <i class="fa fa-info-circle me-2" /> Détails </h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="row g-3">
                                                <div class="col-6">
                                                    <small class="text-muted">Montant total</small>
                                                    <br />
                                                    <strong t-field="cotisation.amount_due"
                                                        t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
                                                </div>

                                                <div class="col-6">
                                                    <small class="text-muted">Déjà payé</small>
                                                    <br />
                                                    <strong class="text-success"
                                                        t-field="cotisation.amount_paid"
                                                        t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
                                                </div>

                                                <div class="col-6">
                                                    <small class="text-muted">Type</small>
                                                    <br />
                                                    <span class="badge"
                                                        t-att-class="'bg-info' if cotisation.cotisation_type == 'monthly' else 'bg-primary'">
                                                        <t
                                                            t-if="cotisation.cotisation_type == 'monthly'">
                                                            Mensuelle</t>
                                                        <t t-else="">Activité</t>
                                                    </span>
                                                </div>

                                                <div class="col-6">
                                                    <small class="text-muted">Date d'échéance</small>
                                                    <br />
                                                    <strong t-field="cotisation.due_date"
                                                        t-options="{'widget': 'date'}" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Colonne droite: Actions -->
                                <div class="col-md-6">
                                    <div class="card border-0 shadow-sm mb-4">
                                        <div class="card-header bg-white border-0">
                                            <h5 class="mb-0 text-primary">
                                                <i class="fa fa-cogs me-2" /> Actions </h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="d-grid gap-2">
                                                <t t-if="can_pay">
                                                    <a
                                                        t-attf-href="/my/cotisation/#{cotisation.id}/pay"
                                                        class="btn btn-primary">
                                                        <i class="fa fa-credit-card me-1" />
                                                        Effectuer un paiement </a>
                                                </t>

                                                <a href="/my/cotisations/history"
                                                    class="btn btn-outline-secondary">
                                                    <i class="fa fa-history me-1" /> Voir
                                                    l'historique </a>

                                                <a href="/my/cotisations"
                                                    class="btn btn-outline-primary">
                                                    <i class="fa fa-list-alt me-1" /> Toutes mes
                                                    cotisations </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- ===============================
                             SECTION: Historique des paiements (CORRIGÉ)
                             =============================== -->
                            <t t-if="payment_history">
                                <div class="row">
                                    <div class="col-12">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-white border-0">
                                                <h5 class="mb-0 text-primary">
                                                    <i class="fa fa-history me-2" /> Historique des
                                                    paiements validés </h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="table-responsive">
                                                    <table class="table table-hover">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th>Date</th>
                                                                <th>Montant</th>
                                                                <th>Méthode</th>
                                                                <th>Référence</th>
                                                                <th>Statut</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr t-foreach="payment_history"
                                                                t-as="payment">
                                                                <!-- CORRECTION: Utilisation de span
                                                                avec t-field -->
                                                                <td>
                                                                    <span
                                                                        t-field="payment.validation_date"
                                                                        t-options="{'widget': 'date'}" />
                                                                </td>

                                                                <td>
                                                                    <span t-field="payment.amount"
                                                                        t-options="{'widget': 'monetary', 'display_currency': cotisation.currency_id}" />
                                                                </td>

                                                                <td>
                                                                    <t
                                                                        t-if="payment.payment_method == 'mobile_money'">Mobile
                                                                        Money</t>
                                                                    <t
                                                                        t-elif="payment.payment_method == 'bank_transfer'">
                                                                        Virement</t>
                                                                    <t
                                                                        t-elif="payment.payment_method == 'cash'">
                                                                        Espèces</t>
                                                                    <t
                                                                        t-elif="payment.payment_method == 'card'">
                                                                        Carte</t>
                                                                    <t t-else="">Autre</t>
                                                                </td>

                                                                <td>
                                                                    <span
                                                                        t-esc="payment.reference or '-'" />
                                                                </td>

                                                                <td>
                                                                    <span class="badge bg-success">
                                                                        Validé</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </t>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- ============================================
     ALTERNATIVE: Template avec formatage manuel des dates
     ============================================ -->
    <template id="cotisation_detail_alternative" name="Détail de Cotisation (Alternative)">
        <t t-call="portal.portal_layout">
            <t t-set="breadcrumbs_searchbar" t-value="True" />

            <div class="o_portal_wrap">
                <!-- ... reste du contenu identique ... -->

                <!-- SECTION: Historique des paiements avec formatage manuel -->
                <t t-if="payment_history">
                    <div class="row">
                        <div class="col-12">
                            <div class="card border-0 shadow-sm">
                                <div class="card-header bg-white border-0">
                                    <h5 class="mb-0 text-primary">
                                        <i class="fa fa-history me-2" /> Historique des paiements
                                        validés </h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead class="table-light">
                                                <tr>
                                                    <th>Date</th>
                                                    <th>Montant</th>
                                                    <th>Méthode</th>
                                                    <th>Référence</th>
                                                    <th>Statut</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr t-foreach="payment_history" t-as="payment">
                                                    <!-- MÉTHODE 1: Formatage manuel de la date -->
                                                    <td
                                                        t-esc="payment.validation_date.strftime('%d/%m/%Y') if payment.validation_date else '-'" />

                                                    <!-- MÉTHODE 2: Formatage manuel du montant -->
                                                    <td>
                                                        <t t-set="currency_symbol"
                                                            t-value="cotisation.currency_id.symbol or ''" />
                                                        <span
                                                            t-esc="'%.2f %s' % (payment.amount, currency_symbol)" />
                                                    </td>

                                                    <td>
                                                        <t
                                                            t-if="payment.payment_method == 'mobile_money'">
                                                            <i
                                                                class="fa fa-mobile text-success me-1" />Mobile
                                                            Money </t>
                                                        <t
                                                            t-elif="payment.payment_method == 'bank_transfer'">
                                                            <i
                                                                class="fa fa-university text-primary me-1" />
                                                            Virement
                                                    </t>
                                                        <t t-elif="payment.payment_method == 'cash'">
                                                            <i class="fa fa-money text-success me-1" />
                                                            Espèces
                                                    </t>
                                                        <t t-elif="payment.payment_method == 'card'">
                                                            <i
                                                                class="fa fa-credit-card text-info me-1" />
                                                            Carte
                                                    </t>
                                                        <t t-else="">
                                                            <i
                                                                class="fa fa-question-circle text-muted me-1" />
                                                            Autre
                                                    </t>
                                                    </td>

                                                    <td>
                                                        <span class="text-monospace"
                                                            t-esc="payment.reference or '-'" />
                                                    </td>

                                                    <td>
                                                        <span class="badge bg-success">
                                                            <i class="fa fa-check me-1" />Validé </span>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
            </div>
        </t>
    </template>
</odoo>